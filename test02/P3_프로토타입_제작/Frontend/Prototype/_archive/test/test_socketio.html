<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.io í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .status {
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
        }
        .connected {
            background: #4CAF50;
            color: white;
        }
        .disconnected {
            background: #f44336;
            color: white;
        }
        .waiting {
            background: #ff9800;
            color: white;
        }
        .log {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #2196F3;
            color: white;
        }
        button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <h1>ğŸ”Œ Socket.io ì—°ê²° í…ŒìŠ¤íŠ¸</h1>

    <div id="status" class="status waiting">
        â³ ì—°ê²° ëŒ€ê¸° ì¤‘...
    </div>

    <button onclick="testNotification()">ğŸ”” í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë³´ë‚´ê¸°</button>
    <button onclick="clearLog()">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>

    <h2>ğŸ“‹ ë¡œê·¸</h2>
    <div id="log" class="log">
        <div class="log-entry">ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘...</div>
    </div>

    <!-- Socket.io CDN -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const logDiv = document.getElementById('log');
        const statusDiv = document.getElementById('status');

        function addLog(message) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            logDiv.innerHTML = '<div class="log-entry">ë¡œê·¸ ì´ˆê¸°í™”ë¨</div>';
        }

        function testNotification() {
            addLog('ğŸ”” í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ìš”ì²­ ë³´ëƒ„');
            fetch('http://localhost:3030/test-notification', {
                method: 'POST'
            })
            .then(() => addLog('âœ… í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ìš”ì²­ ì„±ê³µ'))
            .catch(err => addLog('âŒ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ìš”ì²­ ì‹¤íŒ¨: ' + err.message));
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œì‘
        addLog('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');

        // Socket.io ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
        if (typeof io === 'undefined') {
            addLog('âŒ Socket.io ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨!');
            statusDiv.textContent = 'âŒ Socket.io ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìŒ';
            statusDiv.className = 'status disconnected';
        } else {
            addLog('âœ… Socket.io ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì„±ê³µ');

            // Socket.io ì—°ê²° ì‹œì‘
            addLog('ğŸ”Œ Socket.io ì—°ê²° ì‹œë„ ì¤‘... (http://localhost:3030)');

            const socket = io('http://localhost:3030', {
                reconnection: true,
                reconnectionDelay: 1000,
                reconnectionAttempts: 10
            });

            socket.on('connect', () => {
                addLog('âœ… Socket.io ì„œë²„ ì—°ê²° ì„±ê³µ!');
                addLog('ğŸ“¡ ì†Œì¼“ ID: ' + socket.id);
                statusDiv.textContent = 'âœ… ì—°ê²°ë¨';
                statusDiv.className = 'status connected';
            });

            socket.on('disconnect', (reason) => {
                addLog('âŒ Socket.io ì„œë²„ ì—°ê²° ëŠê¹€: ' + reason);
                statusDiv.textContent = 'âŒ ì—°ê²° ëŠê¹€';
                statusDiv.className = 'status disconnected';
            });

            socket.on('connect_error', (error) => {
                addLog('âš ï¸ ì—°ê²° ì˜¤ë¥˜: ' + error.message);
            });

            socket.on('reconnect_attempt', (attemptNumber) => {
                addLog('ğŸ”„ ì¬ì—°ê²° ì‹œë„ #' + attemptNumber);
            });

            // ìƒˆ Order ì•Œë¦¼ ìˆ˜ì‹ 
            socket.on('new-order-alert', (data) => {
                addLog('ğŸ“¬ ìƒˆ Order ì•Œë¦¼ ë°›ìŒ!');
                addLog('   Order ID: ' + data.orderId);
                addLog('   Order Name: ' + data.orderName);
                alert('ğŸ“¬ ìƒˆ Order ë„ì°©!\n\n' + data.orderId + '\n' + data.orderName);
            });

            // ì „ì—­ ë³€ìˆ˜ë¡œ ì €ì¥ (ë””ë²„ê¹…ìš©)
            window.testSocket = socket;
            addLog('ğŸ’¡ ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ "testSocket"ìœ¼ë¡œ ì†Œì¼“ ê°ì²´ ì ‘ê·¼ ê°€ëŠ¥');
        }

        addLog('ğŸ ìŠ¤í¬ë¦½íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
</body>
</html>
