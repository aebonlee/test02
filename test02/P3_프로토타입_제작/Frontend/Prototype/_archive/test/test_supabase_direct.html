<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Supabase ì§ì ‘ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supabase ê³µì§€ì‚¬í•­ í…ŒìŠ¤íŠ¸</h1>
    <div id="result" style="white-space: pre-wrap; font-family: monospace; padding: 20px; background: #f5f5f5;"></div>

    <script>
        const result = document.getElementById('result');

        async function test() {
            result.textContent = 'í…ŒìŠ¤íŠ¸ ì‹œì‘...\n\n';

            try {
                // Step 1: ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                result.textContent += 'Step 1: Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸\n';
                if (typeof supabase === 'undefined') {
                    throw new Error('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨');
                }
                result.textContent += 'âœ… Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œë¨\n\n';

                // Step 2: í´ë¼ì´ì–¸íŠ¸ ìƒì„±
                result.textContent += 'Step 2: í´ë¼ì´ì–¸íŠ¸ ìƒì„±\n';
                const SUPABASE_URL = 'https://zwjmfewyshhwpgwdtrus.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp3am1mZXd5c2hod3Bnd2R0cnVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI5NDI1MTMsImV4cCI6MjA0ODUxODUxM30.ibeW8lMxCqixNowDPCVIeM30iHo3k-_Zti1nObqMnXU';

                const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                result.textContent += 'âœ… í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì™„ë£Œ\n\n';

                // Step 3: ë°ì´í„° ì¡°íšŒ
                result.textContent += 'Step 3: notices í…Œì´ë¸” ì¡°íšŒ\n';
                const { data, error } = await client
                    .from('notices')
                    .select('*')
                    .order('important', { ascending: false })
                    .order('created_at', { ascending: false })
                    .limit(3);

                if (error) {
                    result.textContent += 'âŒ ì˜¤ë¥˜ ë°œìƒ:\n';
                    result.textContent += `  code: ${error.code}\n`;
                    result.textContent += `  message: ${error.message}\n`;
                    result.textContent += `  details: ${error.details}\n`;
                    result.textContent += `  hint: ${error.hint}\n`;
                    result.textContent += `\nì „ì²´ ì˜¤ë¥˜ ê°ì²´:\n${JSON.stringify(error, null, 2)}\n`;
                } else {
                    result.textContent += `âœ… ì„±ê³µ! ${data.length}ê°œ ê³µì§€ì‚¬í•­ ë¡œë“œë¨\n\n`;

                    if (data.length > 0) {
                        result.textContent += 'ê³µì§€ì‚¬í•­ ëª©ë¡:\n';
                        result.textContent += 'â”€'.repeat(80) + '\n';
                        data.forEach((notice, i) => {
                            const mark = notice.important ? 'ğŸ”´' : 'ğŸ“Œ';
                            result.textContent += `${i+1}. ${mark} ${notice.title}\n`;
                            result.textContent += `   ì‘ì„±ì¼: ${new Date(notice.created_at).toLocaleDateString('ko-KR')}\n`;
                            result.textContent += `   ë‚´ìš©: ${notice.content.substring(0, 50)}...\n\n`;
                        });
                    } else {
                        result.textContent += 'âš ï¸ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.\n';
                    }
                }

            } catch (e) {
                result.textContent += `\nâŒ ì˜ˆì™¸ ë°œìƒ:\n${e.message}\n${e.stack}`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰
        window.addEventListener('load', test);
    </script>
</body>
</html>
