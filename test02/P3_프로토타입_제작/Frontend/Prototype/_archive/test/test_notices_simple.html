<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì§€ì‚¬í•­ í…ŒìŠ¤íŠ¸</title>

    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>ê³µì§€ì‚¬í•­ ë¡œë“œ í…ŒìŠ¤íŠ¸</h1>
    <div id="status" style="padding: 20px; margin: 20px; border: 1px solid #ccc;">
        í…ŒìŠ¤íŠ¸ ì¤‘...
    </div>
    <div id="notices" style="padding: 20px; margin: 20px; border: 1px solid #ccc;">

    </div>

    <script>
        const SUPABASE_URL = 'https://zwjmfewyshhwpgwdtrus.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp3am1mZXd5c2hod3Bnd2R0cnVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI5NDI1MTMsImV4cCI6MjA0ODUxODUxM30.ibeW8lMxCqixNowDPCVIeM30iHo3k-_Zti1nObqMnXU';

        const statusDiv = document.getElementById('status');
        const noticesDiv = document.getElementById('notices');

        async function testNotices() {
            try {
                statusDiv.innerHTML = 'â³ Step 1: Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸ ì¤‘...';
                console.log('Step 1: Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸');

                if (typeof supabase === 'undefined') {
                    throw new Error('Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                }
                console.log('âœ… Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ');

                statusDiv.innerHTML = 'â³ Step 2: Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì¤‘...';
                console.log('Step 2: Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±');

                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì™„ë£Œ:', supabaseClient);

                statusDiv.innerHTML = 'â³ Step 3: ê³µì§€ì‚¬í•­ ì¡°íšŒ ì¤‘...';
                console.log('Step 3: ê³µì§€ì‚¬í•­ ì¡°íšŒ ì‹œì‘');
                console.log('  - URL:', SUPABASE_URL);
                console.log('  - ANON_KEY:', SUPABASE_ANON_KEY.substring(0, 20) + '...');

                const { data, error } = await supabaseClient
                    .from('notices')
                    .select('*')
                    .order('important', { ascending: false })
                    .order('created_at', { ascending: false })
                    .limit(5);

                console.log('Step 4: ì‘ë‹µ í™•ì¸');
                console.log('  - data:', data);
                console.log('  - error:', error);

                if (error) {
                    console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:');
                    console.error('  - code:', error.code);
                    console.error('  - message:', error.message);
                    console.error('  - details:', error.details);
                    console.error('  - hint:', error.hint);
                    throw error;
                }

                statusDiv.innerHTML = `âœ… ì„±ê³µ! ê³µì§€ì‚¬í•­ ${data.length}ê°œ ë¡œë“œë¨`;
                console.log('âœ… ê³µì§€ì‚¬í•­ ë¡œë“œ ì„±ê³µ:', data.length, 'ê°œ');

                noticesDiv.innerHTML = '<h2>ê³µì§€ì‚¬í•­ ëª©ë¡</h2>';

                if (data.length === 0) {
                    noticesDiv.innerHTML += '<p>ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    data.forEach((notice, index) => {
                        const mark = notice.important ? 'ğŸ”´' : 'ğŸ“Œ';
                        noticesDiv.innerHTML += `
                            <div style="padding: 10px; margin: 10px 0; background: #f8f9fa; border-left: 3px solid ${notice.important ? '#dc3545' : '#6c757d'};">
                                <div><strong>${mark} ${notice.title}</strong></div>
                                <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
                                    ${new Date(notice.created_at).toLocaleDateString('ko-KR')}
                                </div>
                            </div>
                        `;
                    });
                }

            } catch (error) {
                console.error('âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                statusDiv.innerHTML = `âŒ ì‹¤íŒ¨: ${error.message}`;
                statusDiv.style.background = '#ffe0e0';
                statusDiv.style.color = '#dc3545';

                noticesDiv.innerHTML = `
                    <h2>ì˜¤ë¥˜ ìƒì„¸</h2>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', testNotices);
        } else {
            testNotices();
        }
    </script>
</body>
</html>
