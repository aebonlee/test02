# SSAL Works 기능 요구사항 명세서

> **최종 업데이트:** 2025-12-02
> **작성자:** Sunny (써니)
> **MVP 범위:** Phase 1-5 (웹사이트 개발 프로젝트만)
> **주요 변경:**
> - 구독 모델 변경 (설치비 + 월 사용료 + 3개월 챌린지)
> - AI 크레딧 시스템 추가 (실시간 차감, 동적 가격)
> - Admin Dashboard 14개 관리 섹션 추가
> - 자동화 기능 추가 (가격 업데이트, 청구, 알림)

---

## 📋 문서 개요

본 문서는 SSAL Works MVP의 기능 요구사항을 정의합니다.

**MVP 제약사항:**
- ✅ 웹사이트 개발 프로젝트만 지원
- ❌ 책 쓰기 프로젝트 제외 (Phase 2)
- ❌ 팀 협업 기능 제외
- ❌ 자동 결제 제외 (수동 송금만)

---

## 🎯 핵심 기능

### 1. 사용자 인증 (Authentication)

#### 1.1 회원가입

**기능 ID:** FR-AUTH-001

**설명:** 신규 사용자가 이메일과 비밀번호로 계정 생성

**입력:**
- 이메일 (필수)
- 비밀번호 (필수, 8자 이상)
- 비밀번호 확인 (필수)
- 닉네임 (선택)

**처리:**
1. 이메일 중복 검증
2. 비밀번호 강도 검증
3. Supabase Auth에 사용자 등록
4. 이메일 인증 메일 발송
5. `users` 테이블에 프로필 생성
6. `subscriptions` 테이블에 `pending` 상태 레코드 생성

**출력:**
- 성공: 이메일 인증 안내 페이지로 이동
- 실패: 오류 메시지 표시

**예외 처리:**
- 이메일 중복: "이미 가입된 이메일입니다"
- 약한 비밀번호: "8자 이상, 영문+숫자 조합 필요"

#### 1.2 로그인

**기능 ID:** FR-AUTH-002

**설명:** 기존 사용자가 로그인

**입력:**
- 이메일
- 비밀번호

**처리:**
1. Supabase Auth 인증
2. 세션 생성
3. 대시보드로 리디렉션

**출력:**
- 성공: 대시보드 페이지
- 실패: "이메일 또는 비밀번호가 잘못되었습니다"

#### 1.3 로그아웃

**기능 ID:** FR-AUTH-003

**처리:**
1. Supabase 세션 종료
2. 로컬 스토리지 클리어
3. 로그인 페이지로 이동

---

### 2. 구독 관리 (Subscription)

#### 2.1 설치비 결제

**기능 ID:** FR-SUB-001

**설명:** 사용자가 ₩3,000,000 설치비 결제 (1회)

**화면:**
```
┌─────────────────────────────────┐
│ SSAL Works 설치비 결제           │
├─────────────────────────────────┤
│ 설치비: ₩3,000,000 (1회)        │
│                                 │
│ 포함 내용:                      │
│ ✓ 프로젝트 관리 시스템 설치     │
│ ✓ PROJECT SAL Grid 설치         │
│ ✓ Books 콘텐츠 무제한           │
│ ✓ 써니에게 묻기                 │
│                                 │
│ 📌 1~3개월 월 사용료 무료!      │
│ (₩50,000 × 3 → ₩0)              │
│                                 │
│ 🎯 3개월 챌린지 참여 가능       │
│ (목표 달성 시 50% 환불)         │
│                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ 입금 계좌 정보                  │
│ 은행: 신한은행                  │
│ 계좌: 110-XXX-XXXXXX            │
│ 예금주: (사업자명)              │
│ 금액: ₩3,000,000                │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                 │
│ 입금자명: [________] (필수)     │
│                                 │
│ 3개월 챌린지 참여: [✓] (선택)  │
│                                 │
│ [입금 완료] 버튼                │
└─────────────────────────────────┘
```

**처리:**
1. 사용자가 은행 앱에서 송금 (₩3,000,000)
2. 입금자명 입력
3. 챌린지 참여 여부 선택
4. "입금 완료" 클릭
5. DB에 요청 기록:
   ```sql
   UPDATE subscriptions
   SET status = 'pending_installation',
       depositor_name = '김철수',
       deposit_request_date = NOW(),
       installation_fee_paid = false,
       challenge_enrolled = true,
       deposit_note = '신청자 입력 메모'
   WHERE user_id = current_user_id;
   ```
6. 대기 화면 표시

**출력:**
```
┌─────────────────────────────────┐
│ 설치비 입금 확인 중입니다       │
├─────────────────────────────────┤
│ 입금자명: 김철수                │
│ 금액: ₩3,000,000                │
│ 신청일시: 2025-12-02 15:30      │
│                                 │
│ 🎯 3개월 챌린지: 참여           │
│                                 │
│ Sunny가 확인 중입니다...        │
│ (보통 24시간 이내)              │
│                                 │
│ 확인 완료 시 이메일로 알려드립니다 │
└─────────────────────────────────┘
```

#### 2.2 월 사용료 결제

**기능 ID:** FR-SUB-002

**설명:** 매월 ₩50,000 사용료 결제 (4개월차부터, 1~3개월 무료)

**화면:**
```
┌─────────────────────────────────┐
│ 월 사용료 결제                  │
├─────────────────────────────────┤
│ 월 사용료: ₩50,000/월           │
│                                 │
│ 📌 1~3개월 무료!                  │
│                                 │
│ 포함 내용:                      │
│ ✓ 프로젝트 관리 무제한          │
│ ✓ PROJECT SAL Grid 사용         │
│ ✓ Books 콘텐츠 무제한           │
│ ✓ 써니에게 묻기                 │
│                                 │
│ ❌ AI 크레딧 미포함 (별도 충전) │
│                                 │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ 입금 계좌 정보                  │
│ 은행: 신한은행                  │
│ 계좌: 110-XXX-XXXXXX            │
│ 예금주: (사업자명)              │
│ 금액: ₩50,000                   │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                 │
│ 입금자명: [________] (필수)     │
│                                 │
│ [입금 완료] 버튼                │
└─────────────────────────────────┘
```

**처리:**
1. 사용자가 은행 앱에서 송금 (₩50,000)
2. 입금자명 입력
3. "입금 완료" 클릭
4. DB에 요청 기록:
   ```sql
   UPDATE subscriptions
   SET monthly_payment_status = 'pending',
       monthly_depositor_name = '김철수',
       monthly_deposit_request_date = NOW()
   WHERE user_id = current_user_id;
   ```
5. 대기 화면 표시

#### 2.3 3개월 챌린지

**기능 ID:** FR-SUB-003

**설명:** 목표 달성 시 설치비 50% 환불 (₩1,500,000)

**목표 달성 조건:**
1. 3개월 연속 월 사용료 납부 (₩50,000 × 3 = ₩150,000)
2. 최소 1개 프로젝트 완료 (모든 Task 완료)
3. 최소 10회 이상 AI 써니 활용 (크레딧 사용)

**처리:**
```sql
-- 챌린지 진행 상황 확인
SELECT
  u.user_id,
  u.email,
  s.challenge_enrolled,
  s.challenge_start_date,
  COUNT(DISTINCT pt.id) FILTER (WHERE pt.status = 'completed') as monthly_payments,
  COUNT(DISTINCT p.id) FILTER (WHERE p.status = 'completed') as completed_projects,
  COUNT(ct.id) FILTER (WHERE ct.amount < 0) as ai_usage_count,
  CASE
    WHEN COUNT(DISTINCT pt.id) FILTER (WHERE pt.status = 'completed') >= 3
     AND COUNT(DISTINCT p.id) FILTER (WHERE p.status = 'completed') >= 1
     AND COUNT(ct.id) FILTER (WHERE ct.amount < 0) >= 10
    THEN true
    ELSE false
  END as challenge_passed
FROM users u
JOIN subscriptions s ON u.user_id = s.user_id
LEFT JOIN payment_transactions pt ON u.user_id = pt.user_id
  AND pt.payment_type = 'monthly_fee'
  AND pt.created_at >= s.challenge_start_date
  AND pt.created_at <= s.challenge_start_date + INTERVAL '90 days'
LEFT JOIN projects p ON u.user_id = p.user_id
LEFT JOIN credit_transactions ct ON u.user_id = ct.user_id
  AND ct.created_at >= s.challenge_start_date
  AND ct.created_at <= s.challenge_start_date + INTERVAL '90 days'
WHERE s.challenge_enrolled = true
  AND NOW() >= s.challenge_start_date + INTERVAL '90 days'
GROUP BY u.user_id, u.email, s.challenge_enrolled, s.challenge_start_date;
```

**환불 처리:**
```sql
-- 챌린지 성공 시 환불
UPDATE subscriptions
SET challenge_status = 'passed',
    challenge_refund_amount = 1500000,
    challenge_completed_at = NOW()
WHERE user_id = target_user_id
  AND challenge_enrolled = true;

-- 환불 요청 생성
INSERT INTO payment_transactions (
  user_id, payment_type, amount, status,
  transaction_note
) VALUES (
  target_user_id, 'challenge_refund', 1500000, 'pending',
  '3개월 챌린지 목표 달성 - 50% 환불'
);
```

**이메일 알림:**
```
제목: [SSAL Works] 🎉 3개월 챌린지 성공! 환불 안내

{사용자명}님, 축하드립니다!

3개월 챌린지를 성공적으로 완료하셨습니다!

✅ 달성 내역:
- 월 사용료 3개월 납부 완료
- 프로젝트 1개 완료
- AI 써니 10회 이상 활용

💰 환불 안내:
- 환불 금액: ₩1,500,000 (설치비 50%)
- 처리 방법: 무통장 입금으로 환불
- 처리 기간: 영업일 기준 3-5일

환불 계좌 정보를 회신해주시면 처리해드리겠습니다.

감사합니다.
Sunny 드림
```

#### 2.4 구독 승인 (관리자)

**기능 ID:** FR-SUB-004

**설명:** Sunny가 입금 확인 후 구독 활성화 (설치비 또는 월 사용료)

**관리자 페이지:**
```
┌─────────────────────────────────────────────────────────┐
│ 입금 대기 목록                                          │
├──────┬──────────┬──────────┬──────────┬────────────────┤
│ ID   │ 입금자명 │ 이메일   │ 신청일시 │ 액션           │
├──────┼──────────┼──────────┼──────────┼────────────────┤
│ 001  │ 김철수   │ kim@...  │ 15:30    │ [확인 완료]    │
│ 002  │ 이영희   │ lee@...  │ 14:20    │ [확인 완료]    │
└──────┴──────────┴──────────┴──────────┴────────────────┘
```

**처리 (확인 완료 클릭 시):**
1. 관리자가 은행 앱에서 실제 입금 확인
2. "확인 완료" 버튼 클릭
3. DB 업데이트:
   ```sql
   UPDATE subscriptions
   SET status = 'active',
       deposit_confirmed = true,
       confirmed_by = 'sunny',
       confirmed_at = NOW(),
       start_date = NOW(),
       end_date = NOW() + INTERVAL '30 days',
       ai_credit_balance = ai_credit_balance + 10000
   WHERE user_id = target_user_id;
   ```
4. 사용자에게 이메일 발송
5. 사용자 화면 자동 갱신 (구독 활성화)

#### 2.5 월 사용료 만료 알림

**기능 ID:** FR-SUB-005

**설명:** 월 사용료 만료 7일 전 자동 이메일 발송

**트리거:** Supabase Edge Function (매일 00:00 실행)

**처리:**
```sql
SELECT * FROM subscriptions
WHERE status = 'active'
  AND monthly_end_date - NOW() <= INTERVAL '7 days'
  AND monthly_end_date - NOW() > INTERVAL '6 days';
```

**이메일 내용:**
```
제목: [SSAL Works] 월 사용료 결제 안내

안녕하세요, {사용자명}님

월 사용료 결제일이 7일 후입니다.
결제일: {monthly_end_date}

결제 방법:
1. SSAL Works 로그인
2. "월 사용료 결제하기" 클릭
3. ₩50,000 송금
4. 입금 완료 버튼 클릭

감사합니다.
Sunny 드림
```

#### 2.6 월 사용료 갱신

**기능 ID:** FR-SUB-006

**처리:** FR-SUB-002와 동일 (신규 신청과 동일 프로세스)

---

### 3. 프로젝트 관리 (Project Management)

#### 3.1 프로젝트 생성

**기능 ID:** FR-PROJ-001

**설명:** 새 웹사이트 개발 프로젝트 생성

**화면:**
```
┌─────────────────────────────────┐
│ 새 프로젝트 만들기              │
├─────────────────────────────────┤
│ 프로젝트명: [________________]  │
│                                 │
│ 프로젝트 유형:                  │
│ ● 웹사이트 개발                 │
│ ○ 책 쓰기 (Phase 2)             │
│                                 │
│ 설명:                           │
│ [____________________________]  │
│ [____________________________]  │
│                                 │
│ [취소]  [생성하기]              │
└─────────────────────────────────┘
```

**입력:**
- 프로젝트명 (필수)
- 프로젝트 유형 (고정: "website")
- 설명 (선택)

**처리:**
1. `projects` 테이블 INSERT
   ```sql
   INSERT INTO projects (id, user_id, project_name, project_type, description)
   VALUES (uuid_generate_v4(), current_user_id, '포트폴리오 사이트', 'website', '개인 포트폴리오');
   ```
2. 프로젝트 상세 페이지로 이동

**출력:**
- 프로젝트 ID 생성
- PROJECT SAL Grid 초기화 (빈 상태)

#### 3.2 프로젝트 목록 조회

**기능 ID:** FR-PROJ-002

**설명:** 사용자의 모든 프로젝트 목록 표시

**화면 (대시보드):**
```
┌─────────────────────────────────────────────────────────┐
│ 내 프로젝트                                             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ [+ 새 프로젝트]                                         │
│                                                         │
│ ┌───────────────────────────────────┐                  │
│ │ 포트폴리오 사이트                 │                  │
│ │ 웹사이트 개발                     │                  │
│ │ 생성일: 2025-11-14                │                  │
│ │ Task: 12개 (진행 중: 3개)         │                  │
│ │                                   │                  │
│ │ [그리드 보기] [편집] [삭제]       │                  │
│ └───────────────────────────────────┘                  │
│                                                         │
│ ┌───────────────────────────────────┐                  │
│ │ 회사 홈페이지                     │                  │
│ │ 웹사이트 개발                     │                  │
│ │ 생성일: 2025-11-10                │                  │
│ │ Task: 25개 (완료: 15개)           │                  │
│ │                                   │                  │
│ │ [그리드 보기] [편집] [삭제]       │                  │
│ └───────────────────────────────────┘                  │
└─────────────────────────────────────────────────────────┘
```

**쿼리:**
```sql
SELECT p.*,
       COUNT(t.id) as total_tasks,
       COUNT(CASE WHEN t.status = '진행중' THEN 1 END) as in_progress_tasks
FROM projects p
LEFT JOIN project_grid_tasks t ON p.id = t.project_id
WHERE p.user_id = current_user_id
GROUP BY p.id
ORDER BY p.created_at DESC;
```

#### 3.3 프로젝트 수정

**기능 ID:** FR-PROJ-003

**입력:** 프로젝트명, 설명 수정

**처리:**
```sql
UPDATE projects
SET project_name = '새 이름',
    description = '새 설명',
    updated_at = NOW()
WHERE id = project_id AND user_id = current_user_id;
```

#### 3.4 프로젝트 삭제

**기능 ID:** FR-PROJ-004

**설명:** 프로젝트 및 관련 Task 삭제

**확인 다이얼로그:**
```
┌─────────────────────────────────┐
│ 프로젝트 삭제                   │
├─────────────────────────────────┤
│ "포트폴리오 사이트"를           │
│ 정말 삭제하시겠습니까?          │
│                                 │
│ ⚠️  모든 Task도 함께 삭제됩니다 │
│                                 │
│ [취소]  [삭제]                  │
└─────────────────────────────────┘
```

**처리:**
```sql
-- RLS로 CASCADE 처리됨
DELETE FROM projects
WHERE id = project_id AND user_id = current_user_id;
```

---

### 4. PROJECT SAL Grid 관리 (Grid Management)

#### 4.1 그리드 뷰어

**기능 ID:** FR-GRID-001

**설명:** 프로젝트의 PROJECT SAL Grid를 2D 카드 뷰로 시각화

**화면 구성:**

```
┌────────────────────────────────────────────────────────────┐
│ 포트폴리오 사이트 | PROJECT SAL Grid                       │
├────────────────────────────────────────────────────────────┤
│                                                            │
│ [Phase 필터] [Area 필터] [상태 필터] [검색]  [+ Task 추가]│
│                                                            │
│ ━━━ Phase 1: 기획 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                            │
│ Area: Frontend (F)                                         │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐                      │
│ │ P1F1    │ │ P1F2    │ │ P1F3    │                      │
│ │ 와이어  │ │ 디자인  │ │ 컬러    │                      │
│ │ 프레임  │ │ 시스템  │ │ 팔레트  │                      │
│ │         │ │         │ │         │                      │
│ │ 완료 ✅ │ │ 진행중  │ │ 대기    │                      │
│ └─────────┘ └─────────┘ └─────────┘                      │
│                                                            │
│ Area: Backend APIs (BA)                                    │
│ ┌─────────┐ ┌─────────┐                                  │
│ │ P1BA1   │ │ P1BA2   │                                  │
│ │ API     │ │ DB      │                                  │
│ │ 설계    │ │ 스키마  │                                  │
│ │         │ │         │                                  │
│ │ 완료 ✅ │ │ 완료 ✅ │                                  │
│ └─────────┘ └─────────┘                                  │
│                                                            │
│ ━━━ Phase 2: 설계 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│ ...                                                        │
└────────────────────────────────────────────────────────────┘
```

**기능:**
- Phase별 그룹화 표시
- Area별 가로 배치
- Task 카드 드래그 앤 드롭 (순서 변경)
- 상태별 색상 구분:
  - 대기: 회색
  - 진행중: 파란색
  - 완료: 초록색
  - 보류: 주황색
- 클릭 시 Task 상세 팝업

**데이터:**
```sql
SELECT * FROM project_grid_tasks
WHERE project_id = current_project_id
ORDER BY phase, area, level;
```

#### 4.2 Task 생성

**기능 ID:** FR-GRID-002

**설명:** 새 Task 카드 생성

**입력 폼:**
```
┌─────────────────────────────────────────┐
│ Task 추가                               │
├─────────────────────────────────────────┤
│ Task ID: [P][1][F][1]                   │
│          Phase Area Num                 │
│                                         │
│ 업무명: [_________________________]     │
│                                         │
│ Phase: [1▼] (기획/설계/개발/테스트/배포)│
│ Area:  [F▼] (O/D/BI/BA/F/T)             │
│                                         │
│ 상세 설명:                              │
│ [_________________________________]     │
│ [_________________________________]     │
│                                         │
│ 프롬프트 (AI 지시서):                   │
│ [_________________________________]     │
│ [_________________________________]     │
│                                         │
│ 담당자: [Sunny▼]                        │
│ 기간(일): [__] (선택)                   │
│ 상태: [대기▼]                           │
│                                         │
│ [취소]  [생성]                          │
└─────────────────────────────────────────┘
```

**검증:**
- Task ID 중복 체크
- Phase는 1-9
- Area는 O, D, BI, BA, F, T 중 하나
- 업무명 필수

**처리:**
```sql
INSERT INTO project_grid_tasks (
  id, project_id, user_id, task_id, phase, area,
  업무, 상세설명, 프롬프트, 담당자, 예상기간일, status
) VALUES (
  uuid_generate_v4(), current_project_id, current_user_id,
  'P1F1', 1, 'F', '와이어프레임 작성', '...',  '...', 'Sunny', 3, '대기'
);
```

#### 4.3 Task 수정

**기능 ID:** FR-GRID-003

**트리거:** Task 카드 클릭

**팝업:**
```
┌─────────────────────────────────────────┐
│ P1F1 - 와이어프레임 작성                │
├─────────────────────────────────────────┤
│ 📝 상세 설명                            │
│ 메인 페이지, About 페이지 와이어프레임  │
│ Figma에서 작성                          │
│                                         │
│ 🤖 프롬프트 (AI 지시서)                 │
│ Create wireframes for homepage...      │
│                                         │
│ 📊 정보                                 │
│ Phase: 1 (기획)                         │
│ Area: F (Frontend)                      │
│ 담당자: Sunny                           │
│ 기간: 3일                               │
│ 상태: [진행중▼]                         │
│                                         │
│ 📁 산출물 파일                          │
│ - wireframe_home.fig                    │
│ - wireframe_about.fig                   │
│                                         │
│ 💬 코멘트 (3)                           │
│ [코멘트 보기]                           │
│                                         │
│ [수정] [삭제] [Export JSON]             │
└─────────────────────────────────────────┘
```

**수정 가능 항목:**
- 업무명
- 상세설명
- 프롬프트
- 담당자
- 기간
- 상태
- 산출물 파일 경로

#### 4.4 Task 삭제

**기능 ID:** FR-GRID-004

**확인:**
```
Task "P1F1 - 와이어프레임 작성"을 삭제하시겠습니까?
[취소] [삭제]
```

**처리:**
```sql
DELETE FROM project_grid_tasks
WHERE id = task_id AND user_id = current_user_id;
```

#### 4.5 Task Export

**기능 ID:** FR-GRID-005

**설명:** Task를 JSON 파일로 내보내기 (AI 도구 연동용)

**트리거:** Task 상세 팝업에서 "Export JSON" 클릭

**출력 파일:** `claude_code/inbox/P1F1.json`

**파일 내용:**
```json
{
  "task_id": "P1F1",
  "task_name": "와이어프레임 작성",
  "phase": 1,
  "area": "F",
  "description": "메인 페이지, About 페이지 와이어프레임",
  "prompt": "Create wireframes for homepage and about page using Figma...",
  "assigned_to": "Sunny",
  "expected_duration_days": 3,
  "status": "진행중",
  "expected_outputs": [
    "wireframe_home.fig",
    "wireframe_about.fig"
  ],
  "dependencies": ["P1F0"],
  "exported_at": "2025-11-14T15:30:00Z"
}
```

**사용 시나리오:**
1. 사용자가 Task Export
2. 파일을 Claude Code에게 제공
3. Claude Code가 작업 수행
4. 생성된 파일을 프로젝트에 반영
5. Claude Code가 프로젝트 그리드 DB 업데이트 (Supabase)
6. Claude Code가 Task 상태 "완료"로 업데이트
7. 사용자가 뷰어에서 결과 확인

#### 4.6 프로젝트 그리드 CSV Export

**기능 ID:** FR-GRID-006

**설명:** 전체 프로젝트 그리드를 CSV로 내보내기

**트리거:** 그리드 뷰어 상단 "Export CSV" 버튼

**출력:** `PROJECT_GRID_{프로젝트명}_{날짜}.csv`

**형식:**
```csv
TaskID,Phase,Area,Level,업무,상세설명,프롬프트,담당자,예상기간일,status,산출물파일,의존Task
P1F1,1,F,1,와이어프레임 작성,메인/About 페이지,...,Sunny,3,진행중,wireframe_home.fig,P1F0
P1BA1,1,BA,1,API 설계,REST API 엔드포인트,...,Sunny,5,대기,api_spec.yaml,P1F1
```

---

### 5. Books 콘텐츠 (Learning Content)

#### 5.1 Books 카테고리 목록

**기능 ID:** FR-BOOKS-001

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ Books - 학습 자료                                          │
├────────────────────────────────────────────────────────────┤
│                                                            │
│ 🔍 [검색...]                                               │
│                                                            │
│ 📚 카테고리                                                │
│                                                            │
│ ┌─────────────────────────────────────┐                  │
│ │ Claude & Claude Code (10편)         │                  │
│ │ AI 도구 활용법                      │                  │
│ │ [보기 →]                            │                  │
│ └─────────────────────────────────────┘                  │
│                                                            │
│ ┌─────────────────────────────────────┐                  │
│ │ 웹개발 기초 (추가 예정)             │                  │
│ │ HTML, CSS, JavaScript               │                  │
│ │ [준비중]                            │                  │
│ └─────────────────────────────────────┘                  │
│                                                            │
│ ┌─────────────────────────────────────┐                  │
│ │ 프로젝트 관리 (추가 예정)           │                  │
│ │ PROJECT SAL Grid, Task 관리         │                  │
│ │ [준비중]                            │                  │
│ └─────────────────────────────────────┘                  │
└────────────────────────────────────────────────────────────┘
```

**데이터:**
```sql
SELECT category, COUNT(*) as content_count
FROM books_content
GROUP BY category
ORDER BY category;
```

#### 5.2 Books 콘텐츠 목록 (카테고리별)

**기능 ID:** FR-BOOKS-002

**화면 (예: Claude & Claude Code 카테고리):**
```
┌────────────────────────────────────────────────────────────┐
│ Books > Claude & Claude Code                               │
├────────────────────────────────────────────────────────────┤
│                                                            │
│ 1. ✅ 10편: Claude Code 서브 에이전트의 개발분야 활용법   │
│ 2. ✅ 11편: Claude Code 서브 에이전트의 비개발분야 활용법 │
│ 3. ✅ 12편: MCP 기초 - 외부 서비스와 연결하기             │
│ 4. ✅ 13편: MCP 실전 활용법 및 다른 AI 확장 시스템 비교   │
│ 5. ✅ 14편: API를 통한 AI 연동과 협업                     │
│ 6. ✅ 15편: VS Code 완전 정복 - 초보자 필수 가이드        │
│ 7. ✅ 16편: Claude Code와 VS Code 결합 - 기초             │
│ 8. ✅ 17편: Claude Code와 VS Code 결합 - 심화             │
│ 9. ✅ 18편: Claude 토큰 사용료 구조 및 최적화 방안        │
│ 10. ✅ 19편: 작업환경 최적화                              │
└────────────────────────────────────────────────────────────┘
```

**쿼리:**
```sql
SELECT * FROM books_content
WHERE category = 'claude_code'
ORDER BY title;
```

#### 5.3 Books 콘텐츠 뷰어

**기능 ID:** FR-BOOKS-003

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ Books > Claude & Claude Code > 10편                        │
├────────────────────────────────────────────────────────────┤
│ [◀ 목록] [◀ 이전] [다음 ▶]                                │
│                                                            │
│ # Claude Code 서브 에이전트의 개발분야 활용법             │
│                                                            │
│ ## 개요                                                    │
│ Claude Code의 서브 에이전트는...                          │
│                                                            │
│ (Markdown 렌더링된 콘텐츠)                                 │
│                                                            │
│ ...                                                        │
│                                                            │
│ [◀ 이전] [다음 ▶]                                         │
└────────────────────────────────────────────────────────────┘
```

**기능:**
- Markdown을 HTML로 렌더링
- 코드 하이라이팅 (Prism.js 또는 highlight.js)
- 목차 자동 생성 (TOC)
- 이전/다음 콘텐츠 이동

**쿼리:**
```sql
SELECT content_html FROM books_content
WHERE id = content_id;
```

---

### 6. AI 크레딧 관리 (Credit Management)

#### 6.1 크레딧 충전

**기능 ID:** FR-CREDIT-001

**설명:** 사용자가 AI 크레딧을 충전 (토스페이먼츠)

**화면:**
```
┌─────────────────────────────────┐
│ AI 크레딧 충전                  │
├─────────────────────────────────┤
│ 현재 잔액: ₩2,500               │
│                                 │
│ 충전 금액 선택:                 │
│ ○ ₩10,000                       │
│ ○ ₩30,000                       │
│ ○ ₩50,000                       │
│ ○ ₩100,000                      │
│                                 │
│ 💳 결제: 토스페이먼츠           │
│ (카드, 간편결제 등 지원)        │
│                                 │
│ [결제하기] 버튼                 │
└─────────────────────────────────┘
```

**처리:**
1. 토스페이먼츠 결제창 호출
2. 결제 완료 콜백 수신
3. 크레딧 즉시 지급:
```sql
-- 결제 완료 시 크레딧 충전
UPDATE users
SET credit_balance = credit_balance + 10000
WHERE user_id = current_user_id;

INSERT INTO credit_transactions (
  user_id, transaction_type, amount, status,
  payment_method, transaction_note
) VALUES (
  current_user_id, 'recharge', 10000, 'completed',
  'toss_payments', '토스페이먼츠 결제 완료'
);
```

#### 6.2 실시간 크레딧 차감 (FOR UPDATE)

**기능 ID:** FR-CREDIT-002

**설명:** AI 사용 시 실시간으로 크레딧 차감 (트랜잭션 기반, 동시성 제어)

**기술 스택:** PostgreSQL FOR UPDATE (행 잠금)

**처리 흐름:**
```sql
-- Step 1: 트랜잭션 시작 및 잔액 조회 (행 잠금)
BEGIN;

SELECT credit_balance
FROM users
WHERE user_id = current_user_id
FOR UPDATE;  -- 다른 세션의 동시 수정 차단

-- Step 2: 잔액 확인
IF credit_balance < ai_cost THEN
  ROLLBACK;
  RAISE EXCEPTION 'Insufficient credit balance';
END IF;

-- Step 3: AI API 호출 (Perplexity/ChatGPT/Gemini)
-- (API 호출 코드)

-- Step 4: 크레딧 차감
UPDATE users
SET credit_balance = credit_balance - ai_cost,
    updated_at = NOW()
WHERE user_id = current_user_id;

-- Step 5: 트랜잭션 로그 기록
INSERT INTO credit_transactions (
  user_id, transaction_type, amount,
  ai_service, query_text, response_text, status
) VALUES (
  current_user_id, 'usage', -ai_cost,
  'chatgpt', '사용자 질문...', 'AI 응답...', 'completed'
);

-- Step 6: 커밋
COMMIT;
```

**Supabase Realtime UI 업데이트:**
```javascript
// Frontend: 잔액 실시간 구독
const subscription = supabase
  .channel('credit-updates')
  .on(
    'postgres_changes',
    {
      event: 'UPDATE',
      schema: 'public',
      table: 'users',
      filter: `user_id=eq.${userId}`
    },
    (payload) => {
      // UI 자동 업데이트
      setCreditBalance(payload.new.credit_balance);
    }
  )
  .subscribe();
```

#### 6.3 동적 AI 가격 책정

**기능 ID:** FR-CREDIT-003

**설명:** AI별 동적 가격 (API 원가 + 30% 마진)

**가격 테이블:**
```sql
CREATE TABLE ai_pricing (
  ai_service TEXT PRIMARY KEY,  -- 'chatgpt', 'gemini', 'perplexity'
  price_per_query INTEGER,      -- 쿼리당 가격 (원)
  api_cost INTEGER,              -- API 실제 원가 (원)
  margin_rate DECIMAL(3,2),     -- 마진율 (0.30 = 30%)
  last_updated TIMESTAMP
);
```

**가격 계산 방식:** (실시간 - API 원가 매일 변동)
```
[공식] 최종 가격 = API 원가 × 1.3 (10원 단위 올림)

예시 (실제 가격은 매일 변동):
ChatGPT-4:
- API 원가: 매일 변동
- 마진: 30%
- 최종 가격: 실시간 계산 (10원 단위 올림)

Gemini Pro:
- API 원가: 매일 변동
- 마진: 30%
- 최종 가격: 실시간 계산

Perplexity:
- API 원가: 매일 변동
- 마진: 30%
- 최종 가격: 실시간 계산
```

**UI 표시:** (실시간 가격 표시)
```
┌─────────────────────────────────┐
│ AI 선택 (실시간 가격)            │
├─────────────────────────────────┤
│ ○ ChatGPT-4     ₩[실시간]/쿼리  │
│ ○ Gemini Pro    ₩[실시간]/쿼리  │
│ ● Perplexity    ₩[실시간]/쿼리  │
│                                 │
│ 현재 잔액: ₩2,500               │
│ (사용 가능 횟수 실시간 계산)    │
└─────────────────────────────────┘
```

#### 6.4 크레딧 잔액 부족 알림

**기능 ID:** FR-CREDIT-004

**설명:** 잔액이 ₩1,000 미만일 때 알림

**트리거:** AI 사용 후 잔액 확인

**알림 방법:**
1. **즉시 알림** (UI 팝업):
```
┌─────────────────────────────────┐
│ ⚠️  크레딧 부족                 │
├─────────────────────────────────┤
│ 현재 잔액: ₩800                 │
│                                 │
│ 크레딧이 부족합니다.            │
│ 충전하시겠습니까?              │
│                                 │
│ [나중에]  [충전하기]            │
└─────────────────────────────────┘
```

2. **이메일 알림** (1일 1회):
```
제목: [SSAL Works] 크레딧 부족 안내

{사용자명}님, 안녕하세요.

AI 크레딧 잔액이 부족합니다.
현재 잔액: ₩800

충전 방법:
1. SSAL Works 로그인
2. "크레딧 충전" 클릭
3. 원하는 금액 송금

감사합니다.
Sunny 드림
```

**처리:**
```javascript
// AI 사용 후 잔액 확인
if (newBalance < 1000) {
  // UI 팝업 표시
  showLowCreditAlert(newBalance);

  // 이메일 알림 (1일 1회)
  const lastNotified = await getLastCreditNotification(userId);
  if (!lastNotified || isMoreThan24HoursAgo(lastNotified)) {
    await sendLowCreditEmail(userId, newBalance);
    await recordCreditNotification(userId);
  }
}
```

---

### 7. AI Q&A (Perplexity 연동)

#### 7.1 질문하기

**기능 ID:** FR-AI-001

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ AI에게 묻기 (Perplexity)                                   │
├────────────────────────────────────────────────────────────┤
│ 크레딧 잔액: ₩8,500 / ₩10,000                              │
│                                                            │
│ 질문:                                                      │
│ ┌────────────────────────────────────────────────────────┐│
│ │Claude Code에서 MCP 서버를 설정하려면 어떻게 해야 하나요? ││
│ └────────────────────────────────────────────────────────┘│
│                                                            │
│ [질문하기]                                                 │
│                                                            │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                            │
│ 💬 답변:                                                   │
│                                                            │
│ Claude Code에서 MCP 서버를 설정하는 방법은...             │
│ (Perplexity API 응답)                                      │
│                                                            │
│ 📚 참고 자료:                                              │
│ - https://...                                              │
│ - https://...                                              │
│                                                            │
│ 소요 크레딧: ₩500                                          │
│ 남은 크레딧: ₩8,000                                        │
└────────────────────────────────────────────────────────────┘
```

**처리 흐름:**
1. 사용자 질문 입력
2. 크레딧 잔액 확인 (₩0 이상)
3. Perplexity API 호출
   ```javascript
   const response = await fetch('https://api.perplexity.ai/chat/completions', {
     method: 'POST',
     headers: {
       'Authorization': `Bearer ${PERPLEXITY_API_KEY}`,
       'Content-Type': 'application/json'
     },
     body: JSON.stringify({
       model: 'sonar',
       messages: [{role: 'user', content: question}]
     })
   });
   ```
4. 응답 수신 및 비용 계산
5. DB에 로그 기록:
   ```sql
   INSERT INTO ai_query_logs (user_id, question, answer, cost_credit, api_used)
   VALUES (current_user_id, '...', '...', 500, 'perplexity');

   UPDATE subscriptions
   SET ai_credit_balance = ai_credit_balance - 500
   WHERE user_id = current_user_id;
   ```
6. 화면에 답변 표시

**예외 처리:**
- 크레딧 부족: "크레딧이 부족합니다. 다음 달 1일에 충전됩니다."
- API 오류: "일시적 오류가 발생했습니다. 잠시 후 다시 시도해주세요."

#### 7.2 질문 이력 조회

**기능 ID:** FR-AI-002

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 질문 이력                                                  │
├────────────────────────────────────────────────────────────┤
│ 2025-11-14 15:30 | ₩500                                    │
│ Q: Claude Code에서 MCP 서버를 설정하려면...                │
│ A: Claude Code에서 MCP 서버를 설정하는 방법은...           │
│ [다시 보기]                                                │
│                                                            │
│ 2025-11-14 14:20 | ₩300                                    │
│ Q: JavaScript의 async/await란?                             │
│ A: async/await는 비동기 처리를...                          │
│ [다시 보기]                                                │
└────────────────────────────────────────────────────────────┘
```

**쿼리:**
```sql
SELECT * FROM ai_query_logs
WHERE user_id = current_user_id
ORDER BY created_at DESC
LIMIT 50;
```

---

### 8. 써니에게 묻기 (Support Tickets)

#### 8.1 문의 작성

**기능 ID:** FR-SUPPORT-001

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 써니에게 묻기                                              │
├────────────────────────────────────────────────────────────┤
│ 제목:                                                      │
│ [__________________________________________________]       │
│                                                            │
│ 문의 내용:                                                 │
│ ┌────────────────────────────────────────────────────────┐│
│ │                                                        ││
│ │                                                        ││
│ │                                                        ││
│ └────────────────────────────────────────────────────────┘│
│                                                            │
│ ℹ️  보통 24-48시간 이내에 답변 드립니다.                   │
│                                                            │
│ [취소]  [문의하기]                                         │
└────────────────────────────────────────────────────────────┘
```

**처리:**
```sql
INSERT INTO support_tickets (user_id, subject, message, status)
VALUES (current_user_id, '질문 제목', '질문 내용', 'open');
```

**이메일 알림 (Sunny에게):**
```
제목: [SSAL Works] 새 문의 - {subject}

사용자: {user_email}
문의일시: {created_at}

{message}

[답변하기 링크]
```

#### 8.2 문의 목록 조회

**기능 ID:** FR-SUPPORT-002

**화면 (사용자):**
```
┌────────────────────────────────────────────────────────────┐
│ 내 문의 내역                                               │
├────────────────────────────────────────────────────────────┤
│ [+ 새 문의]                                                │
│                                                            │
│ ✅ 답변 완료 | 2025-11-14                                  │
│ 제목: 프로젝트 그리드 Export 문제                          │
│ [보기]                                                     │
│                                                            │
│ 🕐 답변 대기 | 2025-11-13                                  │
│ 제목: 구독 갱신 관련 문의                                  │
│ [보기]                                                     │
└────────────────────────────────────────────────────────────┘
```

#### 8.3 답변 작성 (관리자)

**기능 ID:** FR-SUPPORT-003

**관리자 페이지:**
```
┌────────────────────────────────────────────────────────────┐
│ 문의 관리 (Sunny)                                          │
├────────────────────────────────────────────────────────────┤
│ 답변 대기 (5건) | 답변 완료 (50건)                         │
│                                                            │
│ 🕐 kim@example.com | 2025-11-14 15:30                      │
│ 제목: 프로젝트 그리드 Export 문제                          │
│ 문의: CSV 파일이 다운로드되지 않습니다...                  │
│                                                            │
│ 답변:                                                      │
│ ┌────────────────────────────────────────────────────────┐│
│ │안녕하세요, 김철수님.                                   ││
│ │브라우저 팝업 차단 설정을 확인해주세요...               ││
│ └────────────────────────────────────────────────────────┘│
│                                                            │
│ [답변 완료]                                                │
└────────────────────────────────────────────────────────────┘
```

**처리:**
```sql
UPDATE support_tickets
SET status = 'answered',
    sunny_reply = '답변 내용',
    replied_at = NOW()
WHERE id = ticket_id;
```

**이메일 알림 (사용자에게):**
```
제목: [SSAL Works] 문의 답변 - {subject}

{user_name}님, 안녕하세요.

문의하신 내용에 대한 답변입니다:

{sunny_reply}

추가 문의사항이 있으시면 언제든 연락주세요.

감사합니다.
Sunny 드림
```

---

### 9. Admin Dashboard (관리자 기능)

#### 9.1 공지사항 관리

**기능 ID:** FR-ADMIN-001

**설명:** 공지사항 CRUD (Create, Read, Update, Delete)

**관리자 화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 공지사항 관리                                              │
├────────────────────────────────────────────────────────────┤
│ [+ 새 공지사항]                  🔍 [검색...]  [삭제]     │
│                                                            │
│ ┌────────┬────────────┬──────────┬──────────┬──────────┐  │
│ │ [✓]    │ 제목       │ 작성일   │ 조회수   │ 액션     │  │
│ ├────────┼────────────┼──────────┼──────────┼──────────┤  │
│ │ [ ]    │ 설 연휴... │ 12-30    │ 45       │ [수정]   │  │
│ │ [ ]    │ 새 기능... │ 12-25    │ 120      │ [삭제]   │  │
│ └────────┴────────────┴──────────┴──────────┴──────────┘  │
└────────────────────────────────────────────────────────────┘
```

**기능:**
- 공지사항 작성 (제목, 내용, 중요도)
- 목록 조회 (페이지네이션)
- 수정 및 삭제
- 일괄 삭제
- 조회수 자동 카운트

#### 9.2 학습 콘텐츠 관리

**기능 ID:** FR-ADMIN-002

**설명:** 학습 콘텐츠 3-tier 구조 관리 (Category → Section → Content)

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 학습 콘텐츠 관리                                           │
├────────────────────────────────────────────────────────────┤
│ 📚 Claude & Claude Code                                    │
│   ├ 📂 기초                                                │
│   │  ├ 10편: Claude Code 서브 에이전트 (개발분야)         │
│   │  ├ 11편: Claude Code 서브 에이전트 (비개발분야)       │
│   │  └ [+ 새 콘텐츠]                                       │
│   ├ 📂 심화                                                │
│   │  └ [+ 새 콘텐츠]                                       │
│   └ [+ 새 섹션]                                            │
│                                                            │
│ [+ 새 카테고리]                                            │
└────────────────────────────────────────────────────────────┘
```

#### 9.3 FAQ 관리

**기능 ID:** FR-ADMIN-003

**설명:** FAQ CRUD 및 카테고리 관리

#### 9.4 회원 관리

**기능 ID:** FR-ADMIN-004

**설명:** 회원 목록 조회, 상태 관리, 구독 이력

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 회원 관리                                                  │
├────────────────────────────────────────────────────────────┤
│ 🔍 [이메일/이름 검색]  [필터: 전체▼]                      │
│                                                            │
│ ┌──────────┬────────┬──────────┬──────────┬──────────┐    │
│ │ 이메일   │ 가입일 │ 구독상태 │ 크레딧   │ 액션     │    │
│ ├──────────┼────────┼──────────┼──────────┼──────────┤    │
│ │ kim@...  │ 12-01  │ 활성     │ ₩5,000   │ [상세]   │    │
│ │ lee@...  │ 11-28  │ 대기     │ ₩0       │ [상세]   │    │
│ └──────────┴────────┴──────────┴──────────┴──────────┘    │
└────────────────────────────────────────────────────────────┘
```

#### 9.5 구독 관리

**기능 ID:** FR-ADMIN-005

**설명:** 설치비 및 월 사용료 결제 승인, 챌린지 관리

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 구독 관리                                                  │
├────────────────────────────────────────────────────────────┤
│ [설치비 대기] [월 사용료 대기] [챌린지 관리]              │
│                                                            │
│ ━━ 설치비 입금 대기 (3건) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ ┌──────────┬──────────┬──────────┬──────────┬──────────┐  │
│ │ 입금자명 │ 이메일   │ 금액     │ 신청일시 │ 액션     │  │
│ ├──────────┼──────────┼──────────┼──────────┼──────────┤  │
│ │ 김철수   │ kim@...  │ ₩3M      │ 12-02    │ [승인]   │  │
│ │ 이영희   │ lee@...  │ ₩3M      │ 12-01    │ [승인]   │  │
│ └──────────┴──────────┴──────────┴──────────┴──────────┘  │
│                                                            │
│ ━━ 월 사용료 입금 대기 (5건) ━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ (동일 구조)                                                │
└────────────────────────────────────────────────────────────┘
```

#### 9.6 결제 관리

**기능 ID:** FR-ADMIN-006

**설명:** 모든 결제 내역 조회

#### 9.7 크레딧 관리

**기능 ID:** FR-ADMIN-007

**설명:** 크레딧 충전 승인, 수동 조정

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 크레딧 관리                                                │
├────────────────────────────────────────────────────────────┤
│ [충전 대기] [사용 내역]                                    │
│                                                            │
│ ━━ 충전 대기 (2건) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ ┌──────────┬──────────┬──────────┬──────────┬──────────┐  │
│ │ 입금자명 │ 이메일   │ 금액     │ 신청일시 │ 액션     │  │
│ ├──────────┼──────────┼──────────┼──────────┼──────────┤  │
│ │ 김철수   │ kim@...  │ ₩20K     │ 12-02    │ [승인]   │  │
│ └──────────┴──────────┴──────────┴──────────┴──────────┘  │
└────────────────────────────────────────────────────────────┘
```

#### 9.8 문의 관리

**기능 ID:** FR-ADMIN-008

**설명:** 사용자 문의 답변 (FR-SUPPORT-003과 동일)

#### 9.9 통계 및 분석

**기능 ID:** FR-ADMIN-009

**설명:** 주요 지표 대시보드

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ 📊 대시보드                                                │
├────────────────────────────────────────────────────────────┤
│ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐      │
│ │ 👥 회원  │ │ 💳 수익  │ │ 🪙 크레딧│ │ 💬 문의  │      │
│ │   127    │ │  ₩350M   │ │  활성 85 │ │  대기 3  │      │
│ │  +12     │ │  +₩15M   │ │          │ │          │      │
│ └──────────┘ └──────────┘ └──────────┘ └──────────┘      │
│                                                            │
│ 📈 월별 가입자 추이                                        │
│ (차트)                                                     │
└────────────────────────────────────────────────────────────┘
```

#### 9.10 API 사용량 모니터링

**기능 ID:** FR-ADMIN-010

**설명:** AI API 사용량 및 비용 분석

**화면:**
```
┌────────────────────────────────────────────────────────────┐
│ API 사용량 모니터링                                        │
├────────────────────────────────────────────────────────────┤
│ [오늘] [이번 주] [이번 달]                                 │
│                                                            │
│ ┌────────────┬──────────┬──────────┬──────────┐          │
│ │ AI 서비스  │ 쿼리 수  │ 원가     │ 매출     │          │
│ ├────────────┼──────────┼──────────┼──────────┤          │
│ │ ChatGPT-4  │  1,250   │ ₩150K    │ ₩187K    │          │
│ │ Gemini Pro │  3,400   │ ₩272K    │ ₩340K    │          │
│ │ Perplexity │    890   │ ₩178K    │ ₩213K    │          │
│ │ 합계       │  5,540   │ ₩600K    │ ₩740K    │          │
│ └────────────┴──────────┴──────────┴──────────┘          │
│                                                            │
│ 💰 마진: ₩140K (23.3%)                                     │
└────────────────────────────────────────────────────────────┘
```

#### 9.11 AI 가격 설정

**기능 ID:** FR-ADMIN-011

**설명:** AI별 가격 수동 조정 (자동 업데이트 override)

#### 9.12 이탈 위험 사용자 모니터링

**기능 ID:** FR-ADMIN-012

**설명:** 활동 감소 사용자 자동 탐지

**기준:**
- 7일 이상 미접속
- 크레딧 잔액 ₩500 미만
- 마지막 결제 후 25일 경과

#### 9.13 버그 리포트 관리

**기능 ID:** FR-ADMIN-013

**설명:** 사용자 제보 버그 추적 및 처리

#### 9.14 시스템 설정

**기능 ID:** FR-ADMIN-014

**설명:** 전역 설정 (이메일, API 키, 결제 계좌 등)

---

### 10. 자동화 기능 (Automation)

#### 10.1 AI 가격 자동 업데이트

**기능 ID:** FR-AUTO-001

**설명:** 매일 00:00 KST에 전날 API 원가 기반으로 가격 재계산

**트리거:** Supabase Edge Function (Cron Job)

**처리:** `System_Automation_Workflow.md` 참조

#### 10.2 월 사용료 자동 청구

**기능 ID:** FR-AUTO-002

**설명:** 매월 1일 00:00 KST에 자동 청구 알림 발송

**트리거:** Supabase Edge Function (Cron Job)

**처리:**
```sql
-- 청구 대상 조회
SELECT u.user_id, u.email, s.monthly_end_date
FROM users u
JOIN subscriptions s ON u.user_id = s.user_id
WHERE s.status = 'active'
  AND DATE(s.monthly_end_date) = CURRENT_DATE;
```

**이메일 발송:**
```
제목: [SSAL Works] 월 사용료 청구 안내

{사용자명}님, 안녕하세요.

이번 달 월 사용료가 청구되었습니다.

금액: ₩50,000
결제 기한: {monthly_end_date + 7일}

결제 방법:
1. SSAL Works 로그인
2. "월 사용료 결제하기" 클릭
3. 계좌 이체

감사합니다.
Sunny 드림
```

#### 10.3 이탈 위험 사용자 알림

**기능 ID:** FR-AUTO-003

**설명:** 매일 09:00 KST에 이탈 위험 사용자에게 재참여 유도 이메일

**트리거:** Supabase Edge Function (Cron Job)

**이탈 위험 기준:**
```sql
SELECT u.user_id, u.email, u.last_login_at
FROM users u
JOIN subscriptions s ON u.user_id = s.user_id
WHERE s.status = 'active'
  AND u.last_login_at < NOW() - INTERVAL '7 days'
  AND u.credit_balance < 500;
```

#### 10.4 챌린지 만료 알림

**기능 ID:** FR-AUTO-004

**설명:** 매월 1일 09:00 KST에 챌린지 종료일 도래 사용자에게 알림

**트리거:** Supabase Edge Function (Cron Job)

---

### 11. 실시간 알림 (Real-time Notifications)

#### 11.1 Order Sheet 알림

**기능 ID:** FR-NOTIFY-001

**설명:** Dashboard에서 생성된 Order Sheet를 Claude Code 세션에 실시간으로 알림

**기술 스택:** Socket.io v4.7.2 + Node.js (inbox_server.js)

**시스템 구조:**
```
Dashboard (prototype_index_최종개선.html)
    ↕ Socket.io (port 3030)
inbox_server.js (File Watcher + Socket.io Server)
    ↓
Human_ClaudeCode_Bridge/Orders/
    ↓
Claude Code Session
```

**동작 흐름:**
1. Dashboard에서 Order Sheet 생성
2. JSON 파일이 `Human_ClaudeCode_Bridge/Orders/` 폴더에 저장
3. inbox_server.js의 chokidar file watcher가 새 파일 감지
4. Socket.io `io.emit('new-order-alert', data)` 이벤트 발생
5. 연결된 모든 Dashboard 클라이언트에 브로드캐스트
6. Dashboard에서 중앙 모달 팝업 표시

**입력 (Order Sheet JSON):**
```json
{
  "order_id": "ORDER-GE-251130-91",
  "order_name": "Dashboard에서 생성된 작업",
  "content_korean": "작업 내용...",
  "content_english": "Task content...",
  "priority": "medium",
  "status": "pending",
  "created_at": "2025-11-30T15:29:38.899Z"
}
```

**출력 (Dashboard 알림 팝업):**
- **위치**: 화면 중앙 모달
- **스타일**: 기존 Dashboard 모달과 일치 (흰색 배경, 파란색 버튼)
- **내용**:
  ```
  ┌─────────────────────────────────┐
  │ 📬 새 Order가 도착했습니다!      │
  ├─────────────────────────────────┤
  │ Order Sheet가 Orders에          │
  │ 저장되었습니다.                 │
  │                                 │
  │ [노란색 강조 박스]              │
  │ 원하는 Claude Code 세션에 가서  │
  │ "Orders에 저장된 Order Sheet를  │
  │  확인해줘"                      │
  │ 라고 말씀해주세요.              │
  │ [/노란색 강조 박스]             │
  │                                 │
  │ Order ID: ORDER-GE-251130-91    │
  │                                 │
  │        [확인] (파란색 버튼)     │
  └─────────────────────────────────┘
  ```

**주요 기능:**
- ✅ 실시간 양방향 통신 (WebSocket)
- ✅ 자동 재연결 (reconnection: true, 최대 10회 시도)
- ✅ 연결 상태 로깅 (connect/disconnect 이벤트)
- ✅ 팝업 외부 클릭 시 닫기
- ✅ modalZoomIn/Out 애니메이션

**예외 처리:**
- Socket.io 연결 실패: 콘솔에 "❌ Notification server connection failed" 출력
- 재연결 실패: 콘솔에 "⚠️ Maximum reconnection attempts reached" 출력

**구현 완료:** 2025-12-01

---

#### 11.2 Dashboard 자동 업데이트

**기능 ID:** FR-NOTIFY-002

**설명:** 프로젝트 상태 변경 시 Dashboard 자동 갱신 (예정)

**상태:** 미구현 (Phase 2)

**계획:**
- Supabase Realtime을 통한 DB 변경 감지
- Project Grid 자동 업데이트
- Task 상태 변경 실시간 반영

---

## 🔒 비기능 요구사항 (Non-Functional Requirements)

### NFR-1: 보안

#### NFR-1.1 인증/인가
- Supabase Auth 기반 JWT 토큰 인증
- 모든 API 요청에 인증 필요
- Row Level Security (RLS)로 데이터 격리

#### NFR-1.2 데이터 보호
- 비밀번호 해싱 (bcrypt)
- HTTPS 강제
- SQL Injection 방어 (Prepared Statements)
- XSS 방어 (Content Security Policy)

#### NFR-1.3 API 키 보안
- Perplexity API 키는 서버 사이드에만 저장
- 환경 변수로 관리
- 절대 클라이언트에 노출 금지

### NFR-2: 성능

#### NFR-2.1 응답 시간
- 페이지 로드: 2초 이내
- API 응답: 500ms 이내
- AI Q&A: 5초 이내 (Perplexity API 응답 시간 포함)

#### NFR-2.2 확장성
- 동시 사용자 500명 지원
- 사용자당 프로젝트 수 제한 없음
- Task 수 제한 없음

### NFR-3: 가용성

- 업타임: 99% 이상
- 백업: 일 1회 자동 백업 (Supabase)
- 복구 시간: 4시간 이내

### NFR-4: 호환성

#### NFR-4.1 브라우저
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

#### NFR-4.2 기기
- 데스크톱 (1920×1080 이상)
- 태블릿 (768px 이상)
- 모바일 (375px 이상)

### NFR-5: 사용성

- 반응형 디자인 (모바일 대응)
- 직관적 UI/UX
- 접근성 (WCAG 2.1 AA 준수)
- 다국어 지원 (한국어 우선, 영어 추후)

---

## 📋 제외 범위 (Out of Scope - Phase 2 이후)

- ❌ 책 쓰기 프로젝트
- ❌ 팀 협업 기능 (멤버 초대, 권한 관리)
- ❌ 실시간 채팅
- ❌ 자동 결제 (카드, 자동이체)
- ❌ 크레딧 추가 구매
- ❌ 3D 블록 뷰 (2D 카드 뷰만)
- ❌ 템플릿 마켓플레이스
- ❌ 모바일 네이티브 앱
- ❌ Git 자동 동기화
- ❌ Slack/Discord 연동

---

## 📊 우선순위 (MVP Phase별)

### Phase 1: 인증 & 구독
- FR-AUTH-001, 002, 003 (회원가입, 로그인, 로그아웃)
- FR-SUB-001, 002, 003 (설치비, 월 사용료, 챌린지)

### Phase 2: 프로젝트 관리
- FR-PROJ-001, 002, 003, 004 (프로젝트 CRUD)

### Phase 3: PROJECT SAL Grid
- FR-GRID-001, 002, 003, 004 (그리드 뷰어, Task CRUD)

### Phase 4: 콘텐츠 & AI
- FR-BOOKS-001, 002, 003 (Books 뷰어)
- FR-CREDIT-001, 002, 003, 004, 005 (크레딧 관리)
- FR-AI-001, 002 (AI Q&A)

### Phase 5: 고객 지원 & Admin
- FR-SUPPORT-001, 002, 003 (써니에게 묻기)
- FR-ADMIN-001 ~ 014 (Admin Dashboard)
- FR-AUTO-001 ~ 004 (자동화)
- FR-NOTIFY-001, 002 (실시간 알림)
- FR-SUB-004, 005, 006 (구독 승인, 알림, 갱신)

---

## ✅ 완료 조건 (Definition of Done)

각 기능은 다음 조건을 모두 충족해야 "완료"로 간주:

1. ✅ 코드 작성 완료
2. ✅ Supabase DB 연결 (실제 데이터)
3. ✅ 단위 테스트 통과
4. ✅ 통합 테스트 통과
5. ✅ UI/UX 디자인 반영
6. ✅ 반응형 디자인 적용
7. ✅ 보안 검증 (RLS, 인증)
8. ✅ 성능 테스트 (응답 시간)
9. ✅ 크로스 브라우저 테스트
10. ✅ 문서화 (주석, README)

---

**SSAL Works - 프롬프팅으로 AI를 운전하듯 프로젝트를 관리하세요.**
