# 20편 | Subagents

---

Claude Code는 복잡한 작업을 처리할 때 전문화된 서브에이전트를 활용한다. 코드베이스 탐색, 구현 계획 수립, 병렬 작업 처리 등에서 서브에이전트가 자동으로 투입된다. 이 편에서는 서브에이전트의 개념과 활용법을 살펴본다.

## 1. Subagents 개요

### 1-1 Subagents란

Subagents는 특정 작업을 위임받아 독립적으로 수행하는 전문화된 에이전트이다. Main Agent가 복잡한 작업을 만나면 적합한 Subagent에게 작업을 위임한다.

```
[복잡한 요청]
      ↓
[Main Agent 분석]
      ↓
[Subagent 투입]
      ↓
[Subagent 작업 수행]
      ↓
[결과 반환]
      ↓
[Main Agent가 사용자에게 보고]
```

### 1-2 Main Agent vs Subagent

| 구분 | Main Agent | Subagent |
|------|------------|----------|
| 역할 | 대화 관리, 작업 조율 | 특정 작업 수행 |
| 범위 | 전체 대화 컨텍스트 | 위임받은 작업만 |
| 실행 | 항상 활성화 | 필요할 때 투입 |
| 결과 | 사용자에게 직접 응답 | Main Agent에게 반환 |

### 1-3 Task 도구 사용

Subagent는 Task 도구를 통해 호출된다.

```
사용자: 이 코드베이스에서 API 엔드포인트가 어디 있는지 찾아줘

Claude: [Task 도구 - Explore 서브에이전트 투입]
        코드베이스를 탐색하겠습니다...

        [Explore 서브에이전트가 작업 수행]

        API 엔드포인트 위치:
        - src/api/users.js
        - src/api/posts.js
        - src/api/auth.js
```

## 2. Subagent 유형

### 2-1 general-purpose (범용)

복잡한 질문 조사, 코드 검색, 다단계 작업 처리를 위한 범용 에이전트이다.

**용도:**
- 복잡한 질문에 대한 조사
- 코드 검색 (확실하지 않은 경우)
- 다단계 작업 수행

```
사용자: 이 프로젝트에서 인증 로직이 어떻게 구현되어 있는지 분석해줘

Claude: [Task - general-purpose 서브에이전트]
        인증 로직을 조사하겠습니다...

        분석 결과:
        1. JWT 기반 인증 사용
        2. 토큰은 localStorage에 저장
        3. 만료 시간: 24시간
        ...
```

### 2-2 Explore (코드베이스 탐색)

코드베이스를 빠르게 탐색하는 전문 에이전트이다.

**용도:**
- 파일 패턴으로 찾기 (`src/**/*.tsx`)
- 키워드로 코드 검색
- 코드베이스 구조 파악

**탐색 깊이:**
- quick: 기본 검색
- medium: 중간 수준 탐색
- very thorough: 포괄적 분석

```
사용자: API 엔드포인트가 어떻게 동작하는지 알려줘

Claude: [Task - Explore 서브에이전트 (medium)]
        API 구조를 탐색하겠습니다...

        API 동작 방식:
        - 라우팅: Express 사용
        - 미들웨어: 인증, 로깅, 에러 처리
        - 응답 형식: JSON
        ...
```

### 2-3 Plan (설계/계획)

구현 계획을 수립하는 소프트웨어 아키텍트 에이전트이다.

**용도:**
- 구현 전략 설계
- 단계별 계획 수립
- 아키텍처 트레이드오프 분석

```
사용자: 결제 시스템을 추가하려면 어떻게 해야 할까?

Claude: [Task - Plan 서브에이전트]
        구현 계획을 수립하겠습니다...

        결제 시스템 구현 계획:

        1단계: 데이터베이스 스키마
        - payments 테이블 생성
        - subscriptions 테이블 생성

        2단계: API 개발
        - POST /api/payments/create
        - POST /api/payments/confirm
        ...
```

### 2-4 기타 특화 유형

프로젝트에 따라 다양한 특화 유형이 있을 수 있다.

| 유형 | 용도 |
|------|------|
| frontend-developer | 프론트엔드 개발 |
| backend-developer | 백엔드 개발 |
| database-specialist | 데이터베이스 설계 |
| code-reviewer | 코드 리뷰 |
| test-engineer | 테스트 작성 |

## 3. Subagent 호출

### 3-1 Task 도구 파라미터

Task 도구는 다음 파라미터를 사용한다:

| 파라미터 | 설명 | 예시 |
|----------|------|------|
| prompt | 작업 내용 | "API 구조 분석" |
| subagent_type | 서브에이전트 유형 | "Explore" |
| description | 작업 설명 (3-5단어) | "API 구조 탐색" |
| model | 모델 선택 (선택) | "sonnet", "haiku" |
| run_in_background | 백그라운드 실행 | true/false |

### 3-2 동기/비동기 실행

**동기 실행 (기본):**
Subagent 작업이 완료될 때까지 기다린다.

```
[Task 호출]
      ↓
[Subagent 작업 수행] ← 대기
      ↓
[결과 즉시 반환]
```

**비동기 실행 (백그라운드):**
Subagent가 백그라운드에서 작업하고, 다른 작업을 계속할 수 있다.

```
[Task 호출 - run_in_background: true]
      ↓
[Subagent 백그라운드 작업 시작]
      ↓
[다른 작업 계속 진행]
      ↓
[나중에 TaskOutput으로 결과 확인]
```

### 3-3 결과 받기 (TaskOutput)

백그라운드로 실행한 Subagent의 결과를 가져온다.

```
사용자: 아까 요청한 분석 결과 보여줘

Claude: [TaskOutput - task_id: agent_xyz]
        분석 결과:
        ...
```

**옵션:**
- block: true (완료까지 대기) / false (현재 상태만)
- timeout: 최대 대기 시간 (ms)

## 4. 사용자 정의 Subagents

### 4-1 Subagents 파일 위치

프로젝트 루트에 `.claude/subagents/` 폴더를 만들어 사용한다.

```
프로젝트/
└── .claude/
    └── subagents/
        └── agent이름.md
```

### 4-2 파일 구조

마크다운 파일로 Subagent의 역할과 동작을 정의한다.

```markdown
# agent이름.md

[역할 설명]

## 전문 분야
- [분야 1]
- [분야 2]

## 사용 가능한 도구
- [도구 1]
- [도구 2]

## 작업 방식
1. [단계 1]
2. [단계 2]
3. [단계 3]

## 출력 형식
[결과 형식 설명]
```

### 4-3 작성 예시

**코드 리뷰 전문 에이전트:**
```markdown
# code-reviewer.md

코드 품질을 검토하고 개선점을 제안하는 전문 에이전트입니다.

## 전문 분야
- 코드 품질 분석
- 보안 취약점 탐지
- 성능 문제 식별
- 모범 사례 검증

## 사용 가능한 도구
- Read: 코드 파일 읽기
- Grep: 패턴 검색
- Glob: 파일 찾기

## 작업 방식
1. 대상 코드 파일 읽기
2. 구조 및 패턴 분석
3. 문제점 식별
4. 개선 제안 작성

## 출력 형식
- 요약: 전체 평가
- 문제점: 발견된 이슈 목록
- 제안: 구체적인 개선 방안
- 우선순위: 중요도별 정렬
```

**테스트 엔지니어 에이전트:**
```markdown
# test-engineer.md

테스트 코드를 작성하고 검증하는 전문 에이전트입니다.

## 전문 분야
- 단위 테스트 작성
- 통합 테스트 설계
- 테스트 커버리지 분석
- 엣지 케이스 식별

## 사용 가능한 도구
- Read, Write, Edit: 파일 작업
- Bash: 테스트 실행
- Grep: 테스트 대상 검색

## 작업 방식
1. 테스트 대상 분석
2. 테스트 케이스 설계
3. 테스트 코드 작성
4. 테스트 실행 및 검증

## 출력 형식
- 테스트 파일 생성
- 커버리지 보고
- 실행 결과 요약
```

## 5. 활용 패턴

Subagent를 효과적으로 활용하는 6가지 핵심 패턴이 있다.

### 5-1 체이닝 (Chaining)

여러 Subagent를 순차적으로 연결해서, 앞 단계 결과를 다음 단계 입력으로 사용한다.

```
[요청: 코드 분석 후 테스트 작성]

1. [Explore] 코드 구조 분석
      ↓ (분석 결과)
2. [Plan] 테스트 전략 수립
      ↓ (테스트 계획)
3. [test-engineer] 테스트 코드 작성
      ↓
[최종 결과]
```

**적합한 상황:** 단계별로 진행해야 하는 복잡한 작업

### 5-2 라우팅 (Routing)

요청 유형에 따라 적합한 Subagent를 선택해서 투입한다.

```
[요청 분석]
      ↓
├── 프론트엔드 관련 → [frontend-developer]
├── 백엔드 관련 → [backend-developer]
├── DB 관련 → [database-specialist]
└── 테스트 관련 → [test-engineer]
```

**적합한 상황:** 다양한 유형의 요청을 처리할 때

### 5-3 병렬 처리 (Parallel)

독립적인 작업을 여러 Subagent가 동시에 처리한다.

```
[요청: 프론트엔드와 백엔드 동시 분석]

┌─ [Explore] 프론트엔드 분석 ─┐
│                              │
└─ [Explore] 백엔드 분석 ─────┘
              ↓
      [결과 종합]
```

**적합한 상황:** 서로 의존성이 없는 여러 작업

### 5-4 검증 (Verification)

작업 Subagent와 검증 Subagent를 분리해서 품질을 보장한다.

```
[요청: API 구현 및 검증]

1. [backend-developer] API 구현
      ↓
2. [code-reviewer] 코드 검토  ← 다른 에이전트가 검증
      ↓
3. [test-engineer] 테스트 작성
      ↓
[검증된 결과]
```

**핵심 원칙:** 작성자 ≠ 검증자 (같은 에이전트가 작성과 검증을 하면 안 됨)

### 5-5 분할 정복 (Divide & Conquer)

큰 작업을 작은 단위로 분할해서 각각 처리한 뒤 통합한다.

```
[요청: 대규모 리팩토링]

├── [Subagent A] 모듈 1 리팩토링
├── [Subagent B] 모듈 2 리팩토링
├── [Subagent C] 모듈 3 리팩토링
└── [Subagent D] 모듈 4 리팩토링
              ↓
      [결과 통합]
```

**적합한 상황:** 대규모 작업, 독립적으로 처리 가능한 단위가 있을 때

### 5-6 맥락 기반 선택 (Context-based)

현재 작업 맥락에 따라 가장 적합한 Subagent를 동적으로 선택한다.

```
[현재 맥락 분석]
├── 에러 발생 중 → [devops-troubleshooter]
├── 보안 검토 필요 → [security-specialist]
├── 성능 이슈 → [performance-optimizer]
└── 일반 개발 → [general-purpose]
```

**적합한 상황:** 상황에 따라 필요한 전문성이 달라질 때

### 패턴 선택 가이드

| 상황 | 권장 패턴 |
|------|----------|
| 단계별 진행 필요 | 체이닝 |
| 요청 유형이 다양 | 라우팅 |
| 독립 작업 여러 개 | 병렬 처리 |
| 품질 보장 중요 | 검증 |
| 대규모 작업 | 분할 정복 |
| 상황별 대응 필요 | 맥락 기반 |

## 6. 실전 활용

### 6-1 병렬 작업 처리

여러 Subagent를 동시에 실행해서 작업 속도를 높인다.

```
사용자: 프론트엔드와 백엔드 코드 동시에 분석해줘

Claude:
[병렬 실행]
├── [Task - Explore] 프론트엔드 분석 (백그라운드)
└── [Task - Explore] 백엔드 분석 (백그라운드)

[결과 수집]
├── 프론트엔드: React 기반, 15개 컴포넌트
└── 백엔드: Express 기반, 8개 API 엔드포인트
```

### 6-2 복잡한 작업 분할

큰 작업을 여러 Subagent에게 분할 위임한다.

```
사용자: 전체 코드베이스 리팩토링 계획 세워줘

Claude:
1. [Task - Explore] 현재 구조 파악
   → 폴더 구조, 의존성, 코드 패턴

2. [Task - Plan] 리팩토링 전략 수립
   → 단계별 계획, 우선순위, 리스크

3. [Task - code-reviewer] 문제 영역 식별
   → 기술 부채, 중복 코드, 개선점

종합 결과:
리팩토링 계획서 완성
```

### 6-3 전문 분야 위임

적합한 전문 에이전트에게 작업을 위임한다.

```
사용자: 이 API에 대한 테스트 코드 작성해줘

Claude: [Task - test-engineer 서브에이전트]
        테스트 코드를 작성하겠습니다...

        생성된 파일:
        - src/api/users.test.js
        - src/api/auth.test.js

        테스트 결과:
        - 24개 테스트 케이스 작성
        - 모든 테스트 통과
        - 커버리지: 92%
```

## 7. 비개발 분야 활용

Subagent는 개발자만의 전유물이 아니다. 문서 작성, 콘텐츠 제작, 데이터 분석 등 일반 업무에서도 강력한 도구가 된다.

### 7-1 비즈니스 문서 에이전트

**report-writer (보고서 작성 전문가):**
```markdown
# report-writer.md

비즈니스 보고서 작성 전문가입니다.

## 전문 분야
- 임원진 보고용 요약 (Executive Summary)
- 데이터 기반 분석 리포트
- KPI 대시보드 설명
- 문제점 진단 및 해결방안 제시

## 사용 가능한 도구
- Read, Write: 문서 작업

## 출력 형식
- 명확하고 설득력 있는 구조화된 보고서
```

**proposal-specialist (기획서/제안서 전문가):**
```markdown
# proposal-specialist.md

사업 제안서와 기획서 작성 전문가입니다.

## 전문 분야
- 시장 분석 및 경쟁사 조사
- ROI 계산 및 재무 계획
- 실행 계획 및 일정 수립
- 위험 요소 분석 및 대응 방안

## 출력 형식
- 투자자를 설득할 수 있는 완벽한 제안서
```

### 7-2 콘텐츠 제작 에이전트

**book-planner (도서 기획 전문가):**
```markdown
# book-planner.md

베스트셀러 도서 기획 전문가입니다.

## 전문 분야
- 타겟 독자층 분석
- 전체 목차 구조 설계
- 챕터별 핵심 메시지 정리
- 경쟁 도서 분석 및 차별화

## 출력 형식
- 독자가 끝까지 읽고 싶어하는 책 구조
```

**chapter-writer (챕터 작성 전문가):**
```markdown
# chapter-writer.md

독자를 사로잡는 챕터 작성 전문가입니다.

## 전문 분야
- 흥미로운 도입부와 강력한 마무리
- 실용적 예시와 구체적 사례 활용
- 적절한 분량과 가독성 확보
- 다음 챕터로의 자연스러운 연결
```

### 7-3 활용 워크플로우

**월간 영업 보고서 자동 생성:**
```
"이번 달 영업 데이터로 임원진 보고서 만들어줘"
        ↓
[data-analyst] 영업 데이터 분석
        ↓
[report-writer] 임원진용 요약 보고서 작성
        ↓
[code-reviewer] 최종 검토
```

**책 쓰기 파이프라인:**
```
"AI 활용 창업에 관한 실용서 써줘"
        ↓
[book-planner] 시장 조사, 타겟 독자, 전체 컨셉
        ↓
[Plan] 10개 챕터 목차 및 구조
        ↓
[chapter-writer] 챕터별 초안 작성
        ↓
[fact-checker] 정확성 검증
        ↓
[content-editor] 전체 편집 및 흐름 개선
```

**핵심 장점:** 컨텍스트 오염 방지. 하나의 Claude에게 모든 걸 맡기면 대화가 길어지면서 일관성이 무너지지만, 각 에이전트가 전문 영역에만 집중하므로 고품질 결과물을 지속적으로 생산할 수 있다.

## 8. 정리

### Subagent 유형 요약

| 유형 | 용도 | 사용 시점 |
|------|------|----------|
| general-purpose | 범용 조사/작업 | 복잡한 질문, 다단계 작업 |
| Explore | 코드베이스 탐색 | 구조 파악, 파일 검색 |
| Plan | 설계/계획 수립 | 구현 전략, 아키텍처 |
| 사용자 정의 | 전문 분야 | 프로젝트 특화 작업 |

### 사용 시점 가이드

| 상황 | 권장 Subagent |
|------|--------------|
| "이 코드가 어디 있어?" | Explore |
| "어떻게 구현하면 좋을까?" | Plan |
| "이 코드 검토해줘" | code-reviewer |
| "테스트 작성해줘" | test-engineer |
| "복잡한 분석이 필요해" | general-purpose |

### 사용자 정의 Subagents 요약

```
위치: .claude/subagents/에이전트.md
내용: 역할, 전문 분야, 도구, 작업 방식
활용: 프로젝트 특화 작업 자동화
```

---

**작성일: 2025-12-20 / 수정일: 2025-12-22 / 글자수: 약 8,500자 / 작성자: Claude / 프롬프터: 써니**

