{
  "report_id": "TASK_INSTRUCTION_PENDING_WORK",
  "report_title": "Task Instruction 수정/생성 대기 작업 목록",
  "generated_at": "2025-12-19T12:00:00Z",
  "generator": "Claude Code",
  "status": "작업 대기",

  "summary": {
    "total_tasks": 6,
    "rewrite_tasks": 4,
    "new_tasks": 1,
    "modify_tasks": 1,
    "trigger": "S4 결제 시스템 변경 (토스 페이먼트 → 무통장 입금) + Workflow 문서 검토"
  },

  "pending_tasks": [
    {
      "priority": 1,
      "task_id": "S4O1",
      "task_name": "Cron Jobs 설정",
      "action": "전면 재작성",
      "file": "S4O1_instruction.md",
      "reason": "현재 내용이 '토스 페이먼트 가맹점 등록'으로 잘못 작성됨",
      "new_content": {
        "task_goal": "Vercel Cron Jobs를 이용한 자동화 작업 설정",
        "cron_jobs": [
          {
            "name": "AI 가격 자동 업데이트",
            "schedule": "매일 00:00",
            "description": "OpenAI, Anthropic, Google AI 가격 변동 확인 및 업데이트"
          },
          {
            "name": "이탈 위험 사용자 알림",
            "schedule": "매일 09:00",
            "description": "7일 이상 미로그인 구독 사용자에게 재참여 이메일 발송"
          },
          {
            "name": "구독 만료 처리",
            "schedule": "매일 00:00",
            "description": "만료된 구독 상태 변경, 3일 전 알림 발송"
          },
          {
            "name": "입금 대기 만료 처리",
            "schedule": "매일 00:00",
            "description": "7일 이상 미입금 요청 자동 취소"
          },
          {
            "name": "챌린지 만료 알림",
            "schedule": "매월 1일 09:00",
            "description": "만료 예정 챌린지 알림 발송"
          }
        ]
      }
    },
    {
      "priority": 2,
      "task_id": "S4BA1",
      "task_name": "무통장 입금 결제 API",
      "action": "전면 재작성",
      "file": "S4BA1_instruction.md",
      "reason": "토스 페이먼트 결제 API → 무통장 입금 방식으로 변경",
      "new_content": {
        "task_goal": "무통장 입금 요청 접수 및 결제 정보 관리 API 구현",
        "apis": [
          {
            "name": "입금 요청 API",
            "location": "api/payment/request.js",
            "features": [
              "입금 요청 접수 (user_id, payment_type, amount)",
              "고유 입금 식별 코드 생성",
              "payments 테이블에 상태 'pending'으로 저장",
              "입금 안내 정보 반환 (계좌번호, 예금주, 입금액)"
            ]
          },
          {
            "name": "입금 상태 조회 API",
            "location": "api/payment/status.js",
            "features": [
              "입금 상태 조회 (pending, confirmed, cancelled, expired)",
              "사용자별 입금 내역 조회"
            ]
          },
          {
            "name": "입금 취소 API",
            "location": "api/payment/cancel.js",
            "features": [
              "미확인 입금 요청 취소",
              "상태 'cancelled'로 변경"
            ]
          }
        ],
        "payment_types": [
          {"type": "installation_fee", "description": "설치비", "amounts": [500000, 1000000, 2000000]},
          {"type": "credit", "description": "AI 크레딧 충전", "amounts": [10000, 30000, 50000, 100000]}
        ],
        "bank_info": {
          "bank_name": "환경변수 (BANK_NAME)",
          "account_number": "환경변수 (BANK_ACCOUNT)",
          "account_holder": "환경변수 (BANK_HOLDER)"
        }
      }
    },
    {
      "priority": 3,
      "task_id": "S4BA2",
      "task_name": "입금 확인 API (관리자용)",
      "action": "전면 재작성",
      "file": "S4BA2_instruction.md",
      "reason": "토스 웹훅 API → 관리자 수동 입금 확인 방식으로 변경",
      "new_content": {
        "task_goal": "관리자가 입금을 수동으로 확인하고 서비스를 활성화하는 API 구현",
        "apis": [
          {
            "name": "입금 대기 목록 조회 API",
            "location": "api/admin/payments/pending.js",
            "features": [
              "status='pending'인 입금 요청 목록 조회",
              "필터링 (payment_type, date_range)",
              "페이지네이션"
            ]
          },
          {
            "name": "입금 확인 처리 API",
            "location": "api/admin/payments/confirm.js",
            "features": [
              "관리자 권한 검증 (is_admin 체크)",
              "입금 상태 'confirmed'로 변경",
              "payment_type에 따른 처리 분기",
              "installation_fee: 구독 활성화",
              "credit: 크레딧 충전 + 보너스 적용",
              "확인 기록 저장 (confirmed_by, confirmed_at)"
            ]
          },
          {
            "name": "입금 거부 API",
            "location": "api/admin/payments/reject.js",
            "features": [
              "입금 상태 'rejected'로 변경",
              "거부 사유 기록",
              "사용자에게 이메일 알림"
            ]
          }
        ]
      }
    },
    {
      "priority": 4,
      "task_id": "S4BA3",
      "task_name": "결제/알림 이메일 템플릿",
      "action": "신규 생성",
      "file": "S4BA3_instruction.md",
      "reason": "S2에는 기본 이메일(welcome, password-reset)만 있음. 결제/자동화 관련 이메일 템플릿 필요",
      "new_content": {
        "task_goal": "결제 및 자동화 시스템에서 사용할 이메일 템플릿 구현",
        "email_templates": [
          {"id": "receipt", "subject": "[SSALWorks] 결제 영수증", "trigger": "결제 완료 (설치비/크레딧)"},
          {"id": "billing-success", "subject": "[SSALWorks] 월 구독료 결제 완료", "trigger": "월 자동결제 성공"},
          {"id": "payment-failure", "subject": "[SSALWorks] 결제 실패 안내", "trigger": "결제 실패"},
          {"id": "payment-rejected", "subject": "[SSALWorks] 입금 확인 불가 안내", "trigger": "관리자 입금 거부"},
          {"id": "low-credit", "subject": "크레딧이 부족합니다", "trigger": "잔액 1,000C 미만"},
          {"id": "feature-intro", "subject": "새로운 AI 기능을 사용해보세요", "trigger": "7일+ 미로그인 (잔액 충분)"},
          {"id": "recharge", "subject": "크레딧을 충전하고 AI 기능을 이용하세요", "trigger": "7일+ 미로그인 (잔액 부족)"},
          {"id": "subscription-suspended", "subject": "[SSALWorks] 구독이 정지되었습니다", "trigger": "결제 3회 실패"},
          {"id": "refund-complete", "subject": "[SSALWorks] 환불이 완료되었습니다", "trigger": "환불 처리 완료"},
          {"id": "verify-email-reminder", "subject": "이메일 인증을 완료해주세요", "trigger": "가입 후 24시간 미인증"},
          {"id": "project-registration-reminder", "subject": "첫 프로젝트를 등록해보세요", "trigger": "가입 후 3일, 프로젝트 0개"},
          {"id": "day7-reminder", "subject": "첫 달 무료는 지금이 기회!", "trigger": "무료체험 7일차"},
          {"id": "challenge-expiry", "subject": "[SSALWorks] 챌린지 만료 안내", "trigger": "매월 1일 챌린지 만료"}
        ],
        "notes": [
          "S2의 welcome, password-reset 템플릿은 기존 유지",
          "Resend API 사용",
          "HTML + Plain Text 버전 모두 제공"
        ]
      }
    },
    {
      "priority": 5,
      "task_id": "S4F1",
      "task_name": "관리자 대시보드 강화",
      "action": "전면 재작성",
      "file": "S4F1_instruction.md",
      "reason": "토스 결제 UI → 무통장 입금 관리 UI로 변경",
      "new_content": {
        "task_goal": "관리자가 입금 요청을 확인하고 처리할 수 있는 대시보드 UI 구현",
        "pages": [
          {
            "name": "입금 대기 목록 페이지",
            "location": "pages/admin/payments/pending.html",
            "features": [
              "대기 중인 입금 요청 테이블",
              "컬럼: 사용자명, 결제유형, 금액, 요청일시, 상태",
              "필터: 결제유형, 날짜범위",
              "검색: 사용자명, 이메일"
            ]
          },
          {
            "name": "입금 확인 모달",
            "location": "components/admin/PaymentConfirmModal.js",
            "features": [
              "입금 상세 정보 표시",
              "확인/거부 버튼",
              "거부 시 사유 입력",
              "확인 시 자동 서비스 활성화 안내"
            ]
          },
          {
            "name": "입금 내역 페이지",
            "location": "pages/admin/payments/history.html",
            "features": [
              "전체 입금 내역 조회",
              "상태별 필터 (pending, confirmed, rejected)",
              "Excel 다운로드 기능"
            ]
          }
        ]
      }
    },
    {
      "priority": 6,
      "task_id": "S3F1",
      "task_name": "AI Q&A UI",
      "action": "수정 (내용 추가)",
      "file": "S3F1_instruction.md",
      "reason": "크레딧 부족 시 모달/alert 구현 내용 누락",
      "add_content": {
        "section": "크레딧 부족 처리 UI",
        "features": [
          {
            "name": "크레딧 부족 모달",
            "trigger": "AI 질문 전송 시 크레딧 부족",
            "ui": {
              "title": "크레딧이 부족합니다",
              "message": "AI 기능을 사용하려면 크레딧이 필요합니다.\n현재 잔액: {currentCredit}C\n필요 크레딧: {requiredCredit}C",
              "buttons": [
                {"label": "크레딧 충전하기", "action": "navigate to /pages/subscription/credit-purchase.html"},
                {"label": "취소", "action": "close modal"}
              ]
            }
          },
          {
            "name": "크레딧 경고 표시",
            "trigger": "잔액 1,000C 미만 시",
            "ui": {
              "type": "warning banner",
              "message": "크레딧이 부족합니다. 충전하세요!",
              "location": "AI Q&A 페이지 상단"
            }
          }
        ],
        "code_location": "ai-qa.js 내 sendQuestion() 함수에 추가"
      }
    }
  ],

  "execution_order": [
    "1. S4O1 (Cron Jobs) - 다른 Task에서 참조 없음, 독립적",
    "2. S4BA1 (무통장 입금 API) - S4BA2의 선행 작업",
    "3. S4BA2 (입금 확인 API) - S4BA1 완료 후",
    "4. S4BA3 (이메일 템플릿) - S4BA2에서 이메일 발송 필요",
    "5. S4F1 (관리자 대시보드) - S4BA1, S4BA2 API 연동",
    "6. S3F1 (크레딧 부족 모달) - 독립적, 언제든 가능"
  ],

  "related_files": {
    "existing_report": "Human_ClaudeCode_Bridge/Reports/S4_Task_Instruction_수정사항.json",
    "task_instructions_folder": "S0_Project-SSAL-Grid_생성/ssal-grid/task-instructions/"
  },

  "notes": [
    "다른 Claude Code 작업 완료 후 진행 예정",
    "S2BI4 (플랫폼 알림 시스템)은 필요 없어서 제외됨",
    "이메일만으로 프로덕션 운영 충분"
  ]
}
