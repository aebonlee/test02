# SAL Grid Viewer 문서/구현 불일치 근본 원인 분석

**분석일:** 2026-01-03
**분석 방법:** Git 변경 이력 추적 및 커밋별 diff 분석
**상태:** 분석 완료 - PO 검토 대기

---

## 1. 핵심 결론 (Executive Summary)

### 불일치 발생 원인

```
┌──────────────────────────────────────────────────────────────────────┐
│                                                                      │
│   🔴 근본 원인: 코드 변경 시 문서 동기화 누락                          │
│                                                                      │
│   76b37ff 커밋에서 viewer_json.html의 동작 방식이                     │
│   "로컬 폴더 분기" → "GitHub URL 통합"으로 완전히 변경되었으나,        │
│   관련 문서(CLAUDE.md, 04 규칙, 07 규칙)는 업데이트되지 않음          │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

---

## 2. 시간순 변경 이력 (Timeline)

### Phase 1: 초기 설계 (2025-12-31)

**커밋:** `d32a782` (2025-12-31 03:33)
**내용:** "사용자별 CSV 데이터 분리 로직 문서화"

```
이 시점의 설계:
┌─────────────────────────────────────────────────────────────┐
│  wksun999@gmail.com (관리자)                                 │
│  → method/json/data/in_progress/project_sal_grid.json       │
├─────────────────────────────────────────────────────────────┤
│  일반 사용자                                                 │
│  → method/json/data/users/{email}/project_sal_grid.json     │
└─────────────────────────────────────────────────────────────┘

✅ CLAUDE.md에 이 구조 문서화
✅ 04_grid-writing-supabase.md에 섹션 9 추가
```

---

### Phase 2: 개별 파일 구조 도입 (2026-01-02)

**커밋:** `5a9a3c7` (2026-01-02 19:21)
**내용:** "CSV_Method → JSON_Method 전환 및 개별 Task 파일 구조 도입"

```
구조 변경:
- 단일 파일: project_sal_grid.json (118KB)
     ↓
- 개별 파일: index.json + tasks/*.json (각 1~2KB)

✅ 토큰 효율성 개선 목적
✅ 하지만 "로컬 폴더 분기" 방식은 유지됨
```

---

### Phase 3: 파일명 변경 (2026-01-02)

**커밋:** `d55e96c` (2026-01-02 20:11)
**내용:** "viewer_csv → viewer_json 전체 변경"

```
변경된 것:
- viewer_csv.html → viewer_json.html (파일명만)
- CLAUDE.md: viewer_csv → viewer_json (텍스트만)

변경되지 않은 것:
- in_progress/, users/ 폴더 구조 설명
- wksun999@gmail.com 분기 로직 설명
```

---

### Phase 4: 🔴 핵심 변경 - 문서 미동기화 (2026-01-03)

**커밋:** `76b37ff` (2026-01-03 02:34)
**내용:** "viewer에서 모든 사용자가 GitHub URL 사용하도록 수정"

```
코드 변경 (viewer_json.html):
┌─────────────────────────────────────────────────────────────┐
│  이전: 로컬 폴더 분기 방식                                   │
│                                                             │
│  if (userEmail === 'wksun999@gmail.com') {                  │
│      jsonPath = 'in_progress/project_sal_grid.json';        │
│  } else {                                                   │
│      jsonPath = `users/${email}/project_sal_grid.json`;     │
│  }                                                          │
├─────────────────────────────────────────────────────────────┤
│  이후: GitHub URL 통합 방식                                  │
│                                                             │
│  // 1. Supabase users 테이블에서 github_repo_url 조회        │
│  // 2. GitHub raw URL로 index.json 로드                     │
│  // 3. grid_records/*.json 개별 로드                        │
│  // → 모든 사용자 동일한 방식!                               │
└─────────────────────────────────────────────────────────────┘

🔴 문제: CLAUDE.md, 04 규칙 파일은 업데이트되지 않음!
🔴 문제: 구버전 설계(in_progress/, users/)가 문서에 남아있음
```

**커밋 메시지에서 확인:**
```
- wksun999@gmail.com 로컬 경로 사용 제거
- 모든 사용자가 github_repo_url로 데이터 로드
- 데스크톱/모바일 viewer 둘 다 수정
```

---

### Phase 5: 부분적 문서 업데이트 (2026-01-03)

**커밋:** `d95e819` (2026-01-03 03:06)
**내용:** "웹 배포 파일 빌드 결과 업데이트"

```
CLAUDE.md 변경 (부분적):
- 개별 파일 구조(index.json + grid_records/) 설명 추가 ✅
- wksun999@gmail.com 분기 로직 설명 제거 ✅
- in_progress/, users/ 폴더 설명 제거 ✅

🟡 하지만: GitHub URL 로드 방식은 설명되지 않음
🟡 04_grid-writing-supabase.md는 업데이트되지 않음 (확인 필요)
```

---

### Phase 6: 문서 작성 시 구버전 참조 (2026-01-03)

**커밋:** `4b0f9e1` (2026-01-03 17:xx)
**내용:** PROJECT_SAL_GRID_VIEWER_PROCESS.md 작성

```
문제 발생:
┌─────────────────────────────────────────────────────────────┐
│  이전 세션의 컨텍스트에서 읽은 문서들이 구버전이었음            │
│                                                             │
│  참조한 내용 (구버전):                                       │
│  - in_progress/ 폴더 구조                                   │
│  - users/{email}/ 폴더 구조                                 │
│  - wksun999@gmail.com 분기 로직                             │
│                                                             │
│  실제 구현 (현재):                                           │
│  - Supabase → github_repo_url 조회                          │
│  - GitHub raw URL로 데이터 로드                              │
│  - 모든 사용자 동일 방식                                     │
└─────────────────────────────────────────────────────────────┘

🔴 결과: 문서와 실제 구현 불일치!
```

---

## 3. 불일치 발생 메커니즘

```
┌────────────────────────────────────────────────────────────────────────────┐
│                         불일치 발생 메커니즘                                │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│   [1] 76b37ff 커밋에서 viewer_json.html 동작 방식 완전 변경                 │
│       - wksun999 분기 제거                                                 │
│       - GitHub URL 통합 방식으로 전환                                      │
│                     ↓                                                      │
│   [2] 하지만 관련 문서 업데이트 누락                                        │
│       - CLAUDE.md의 "사용자별 경로 분기 로직" 섹션                          │
│       - 04_grid-writing-supabase.md의 섹션 9                               │
│       - 07_task-crud.md의 JSON Method 설명                                 │
│                     ↓                                                      │
│   [3] d95e819에서 CLAUDE.md 부분 업데이트                                  │
│       - 개별 파일 구조만 반영                                              │
│       - GitHub URL 로드 방식은 미반영                                      │
│                     ↓                                                      │
│   [4] 새 세션에서 이전 컨텍스트의 문서 참조                                 │
│       - 컨텍스트 요약에 구버전 설계 포함                                    │
│       - 또는 규칙 파일(04, 07)이 아직 구버전                               │
│                     ↓                                                      │
│   [5] PROJECT_SAL_GRID_VIEWER_PROCESS.md 작성 시 구버전 기준                │
│       - in_progress/, users/ 폴더 구조 기술                                │
│       - wksun999 분기 로직 기술                                            │
│                     ↓                                                      │
│   [6] 역검증 시 불일치 발견                                                 │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 영향 범위

### 현재 상태 확인

| 문서 | 내용 | 업데이트 필요 |
|------|------|:------------:|
| **CLAUDE.md** | 개별 파일 구조로 업데이트됨 | △ (GitHub URL 방식 미설명) |
| **04_grid-writing-supabase.md** | 확인 필요 | ? |
| **07_task-crud.md** | 확인 필요 | ? |
| **PROJECT_SAL_GRID_VIEWER_PROCESS.md** | 구버전 기준 작성 | ✅ 필요 |

### 실제 존재하지 않는 폴더 (문서에만 있음)

```
❌ method/json/data/in_progress/
❌ method/json/data/completed/
❌ method/json/data/users/
```

---

## 5. 교훈 및 재발 방지

### 발생 원인 요약

1. **코드와 문서의 동기화 누락**: 코드 변경 시 관련 문서를 함께 업데이트하지 않음
2. **부분적 업데이트**: CLAUDE.md만 부분 업데이트, 규칙 파일들은 누락
3. **컨텍스트 의존**: 새 세션에서 이전 컨텍스트의 구버전 정보 참조

### 재발 방지 제안

```
┌─────────────────────────────────────────────────────────────┐
│  코드 변경 시 문서 동기화 체크리스트                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  □ CLAUDE.md 관련 섹션 업데이트                              │
│  □ .claude/rules/ 관련 규칙 파일 업데이트                    │
│  □ .claude/methods/ 관련 방법 파일 업데이트                  │
│  □ 매뉴얼 문서 업데이트 (있는 경우)                          │
│  □ 커밋 메시지에 "docs:" 접두어 포함                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 수정 방향 제안

### Option A: 문서를 현재 구현에 맞게 수정 (권장)

```
현재 구현:
- 모든 사용자: Supabase → github_repo_url 조회 → GitHub raw URL 로드
- 데이터 구조: index.json + grid_records/*.json

수정 대상:
1. PROJECT_SAL_GRID_VIEWER_PROCESS.md - JSON Method 섹션 전면 수정
2. 04_grid-writing-supabase.md - 섹션 9 수정 (필요시)
3. 07_task-crud.md - JSON Method 설명 수정 (필요시)
```

### Option B: 구현을 문서에 맞게 변경

```
문서 설계:
- wksun999@gmail.com: in_progress/ 폴더
- 일반 사용자: users/{email}/ 폴더

변경 필요:
1. viewer_json.html 로직 수정
2. in_progress/, users/ 폴더 생성
3. 데이터 마이그레이션
```

### 권장: Option A

- 현재 GitHub URL 방식이 더 실용적
- 로컬 폴더 관리 불필요
- Supabase users 테이블과 연동되어 확장성 좋음

---

## 7. 상세 커밋 참조

| 커밋 | 날짜 | 내용 | 영향 |
|------|------|------|------|
| d32a782 | 2025-12-31 | 사용자별 CSV 분리 문서화 | 초기 설계 기준 |
| 5a9a3c7 | 2026-01-02 | 개별 파일 구조 도입 | 폴더 구조 변경 |
| d55e96c | 2026-01-02 | viewer_csv → viewer_json | 파일명만 변경 |
| **76b37ff** | **2026-01-03** | **GitHub URL 통합** | **핵심 변경** |
| d95e819 | 2026-01-03 | 웹 배포 빌드 | CLAUDE.md 부분 수정 |
| 4b0f9e1 | 2026-01-03 | 프로세스 문서 작성 | 불일치 발생 |

---

## 8. 결론

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│   불일치 근본 원인: 76b37ff 커밋에서 코드는 변경했으나 문서 동기화 누락   │
│                                                                         │
│   현재 상태:                                                            │
│   - CLAUDE.md: 부분 업데이트됨 (GitHub URL 방식 미설명)                  │
│   - 규칙 파일들: 업데이트 필요 확인                                      │
│   - 프로세스 문서: 구버전 기준으로 작성됨                                │
│                                                                         │
│   권장 조치: 문서를 현재 구현에 맞게 전면 수정                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

**분석 완료:** Claude Code
**다음 액션:** PO 검토 후 수정 방향 결정
