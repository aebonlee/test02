{
  "report_id": "SEC-2026-01-18-001",
  "report_type": "Security Incident Report",
  "report_date": "2026-01-18",
  "severity": "High",
  "status": "Resolved",

  "incident_summary": {
    "title": "RLS 정책 취약점을 이용한 권한 상승 공격",
    "discovery_date": "2026-01-18",
    "discovery_method": "관리자 대시보드에서 의심스러운 계정 발견",
    "affected_systems": ["Supabase users 테이블", "인증 시스템"],
    "data_impact": "사용자 권한 및 크레딧 데이터 무단 변경"
  },

  "incident_details": {
    "description": "공격자가 임시 이메일(oremal.com)로 계정을 생성한 후, 개발용 RLS 정책의 취약점을 이용하여 자신의 role을 'admin'으로, credit_balance를 999981로 변경하는 권한 상승 공격을 수행했습니다.",
    "compromised_accounts": [
      {
        "email": "jiyan18248@oremal.com",
        "created_at": "2026-01-18",
        "attack_vector": "RLS 정책 우회",
        "unauthorized_changes": {
          "role": "user -> admin",
          "credit_balance": "0 -> 999981",
          "builder_id": "무단 부여",
          "installation_fee_paid": "false -> true"
        }
      }
    ],
    "attack_timeline": [
      {
        "time": "발견 시점",
        "action": "관리자 대시보드에서 비정상 계정 탐지"
      },
      {
        "time": "분석 완료",
        "action": "RLS 정책 취약점 확인 - users_dev_update_all 정책"
      },
      {
        "time": "대응 완료",
        "action": "계정 삭제 및 RLS 정책 강화"
      }
    ]
  },

  "root_cause_analysis": {
    "primary_cause": "개발용 RLS 정책이 프로덕션 환경에 적용됨",
    "vulnerable_policy": {
      "name": "users_dev_update_all",
      "type": "UPDATE",
      "using_clause": "true",
      "with_check": "true",
      "risk": "모든 사용자가 자신의 모든 필드를 무제한 수정 가능"
    },
    "contributing_factors": [
      "개발/운영 환경 분리 미흡",
      "민감 필드(role, credit_balance 등) 보호 정책 부재",
      "RLS 정책 배포 전 보안 검토 프로세스 미준수",
      "정기적인 보안 감사 미실시"
    ]
  },

  "remediation_actions": {
    "immediate_actions": [
      {
        "action": "침입 계정 삭제",
        "details": "auth.users 및 public.users에서 의심 계정 완전 삭제",
        "status": "완료"
      },
      {
        "action": "취약 RLS 정책 제거",
        "details": "users_dev_update_all 정책 삭제",
        "status": "완료"
      },
      {
        "action": "보안 RLS 정책 적용",
        "details": "민감 필드 보호 정책 적용",
        "status": "완료"
      }
    ],
    "long_term_actions": [
      {
        "action": "전체 테이블 RLS 점검",
        "details": "9개 테이블에 보안 정책 적용",
        "status": "완료"
      },
      {
        "action": "SECURITY DEFINER 함수 생성",
        "details": "무한 재귀 방지를 위한 secure 함수 구현",
        "status": "완료"
      }
    ]
  },

  "applied_security_measures": {
    "users_table": {
      "protected_fields": ["role", "credit_balance", "builder_id", "installation_fee_paid", "status"],
      "policy_type": "조건부 UPDATE - 민감 필드 변경 불가",
      "sql_file": "S1_개발_준비/Database/30_users_rls_secure.sql"
    },
    "other_tables": {
      "tables": ["projects", "installation_payment_requests", "payment_methods", "billing_history", "credit_transactions", "ai_usage_log", "inquiries", "manuals"],
      "policy_type": "본인 데이터만 접근 + Admin 관리 권한 분리",
      "sql_file": "S1_개발_준비/Database/31_all_tables_rls_secure.sql"
    }
  },

  "lessons_learned": [
    "개발용 RLS 정책은 절대 프로덕션에 배포하지 않는다",
    "민감 필드는 항상 별도의 보호 정책을 적용한다",
    "RLS 정책 변경 시 반드시 보안 검토를 거친다",
    "정기적인 보안 감사와 이상 탐지 모니터링을 수행한다"
  ],

  "recommendations": {
    "process_improvements": [
      "RLS 정책 배포 체크리스트 도입",
      "개발/스테이징/프로덕션 환경 분리 강화",
      "보안 민감 테이블 변경 알림 시스템 구축"
    ],
    "technical_improvements": [
      "민감 필드 변경 감사 로그 테이블 구현",
      "비정상 권한 변경 자동 탐지 트리거 추가",
      "임시 이메일 도메인 차단 고려"
    ]
  },

  "generated_files": [
    "S1_개발_준비/Database/30_users_rls_secure.sql",
    "S1_개발_준비/Database/31_all_tables_rls_secure.sql"
  ],

  "follow_up_required": false,
  "next_review_date": "2026-02-18"
}
